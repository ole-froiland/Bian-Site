<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Velg periode — Gressholmen Kro AS</title>
  <style>
    :root{
      --brand-600:#1f4fcc; --brand-700:#1e3a8a;
      --ink-900:#0b1220; --ink-700:#374151; --border:#e5e7eb;
      --surface:#fff; --shadow:0 10px 28px rgba(2,6,23,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;color:var(--ink-900);background:#fff}
    a{color:inherit}
    .container{max-width:1200px;margin-inline:auto;padding-inline:clamp(20px,6vw,100px)}

    /* Header */
    header{position:sticky;top:0;background:rgba(255,255,255,.96);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);box-shadow:0 8px 18px rgba(2,6,23,.04);z-index:50}
    .nav{display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:12px;padding-block:12px}
    .brand{display:flex;gap:.6rem;align-items:center;text-decoration:none;font-weight:800}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(180deg,var(--brand-600),var(--brand-700));color:#fff;display:grid;place-items:center;box-shadow:var(--shadow)}
    .org{font-weight:800}
    .nav-right{display:flex;align-items:center;gap:10px}
    .chip{border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-weight:700;background:#fff}
    .btn{appearance:none;border:1px solid var(--border);border-radius:999px;padding:9px 14px;background:#fff;font-weight:700;cursor:pointer;box-shadow:0 1px 2px rgba(2,6,23,.06)}

    /* Main */
    main{padding-block:28px}
    .card{width:min(560px,96vw);border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:var(--shadow);margin-inline:auto}
    h1{margin:0 0 14px;font-size:20px;letter-spacing:-.01em}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;font-weight:600;font-size:.92rem;margin-bottom:6px}
    input[type="date"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff}
    .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:16px}
    button{appearance:none;border:1px solid var(--border);border-radius:12px;padding:10px 16px;background:#111827;color:#fff;font-weight:700;cursor:pointer}
    button:disabled{opacity:.55;cursor:not-allowed}
    small{display:block;color:#6b7280;margin-top:6px}
      .rightwrap{display:flex;justify-content:flex-end}
    .card{margin-left:auto;margin-right:0}
    .presets{display:flex;gap:8px;justify-content:flex-end;margin-bottom:12px}
    .chipbtn{appearance:none;border:1px solid var(--border);background:#fff;border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer}
    .chipbtn.active{background:var(--brand-600);color:#fff;border-color:transparent}
  </style>

  <!-- Enkel auth-guard (samme som tidligere). Fjern hvis du ikke vil ha innlogging. -->
  <script>
    (function(){
      try{
        const authed = localStorage.getItem('bian.authed') === '1';
        const user = (localStorage.getItem('bian.user')||'').toLowerCase();
        if(!authed || user!=='test@gressholmen.no'){
          window.location.replace('login.html');
        }
      }catch(e){
        window.location.replace('login.html');
      }
    })();
  </script>
</head>
<body>
  <a class="skip-link" href="#main" style="position:absolute;left:12px;top:8px;padding:10px 14px;border-radius:12px;background:#0b1220;color:#fff;text-decoration:none;box-shadow:var(--shadow);transform:translateY(-160%);transition:transform .12s ease;z-index:1000">Hopp til innhold</a>

  <header>
    <div class="container nav">
      <a class="brand" href="index.html" title="Til forsiden">
        <div class="logo">B</div><span>Bian Analytics</span>
      </a>
      <div style="justify-self:center;text-align:center">
        <div class="org">Gressholmen Kro AS</div>
        <div class="sub" id="subtitle" style="color:#374151"></div>
      </div>
      <div class="nav-right">
        <span id="who" class="chip" title="Innlogget bruker">…</span>
        <button id="logout" class="btn">Logg ut</button>
      </div>
    </div>
  </header>

  <main id="main">
    <div class="container">
      <div class="rightwrap">
        <section class="card" aria-label="Velg periode">
          <h1>Velg periode</h1>

          <div class="presets" role="group" aria-label="Hurtigvalg for periode">
            <button class="chipbtn" data-preset="day">I dag</button>
            <button class="chipbtn" data-preset="7">Siste 7</button>
            <button class="chipbtn" data-preset="30">Siste 30</button>
          </div>

          <div class="row">
            <div>
              <label for="from">Start</label>
              <input id="from" type="date" autocomplete="off">
            </div>
            <div>
              <label for="to">Slutt</label>
              <input id="to" type="date" autocomplete="off">
            </div>
          </div>
          <div class="actions">
            <button id="save" disabled>Bruk</button>
          </div>
          <small id="hint"></small>
        </section>
      </div>
    </div>
  </main>

  <script>
    // Header-info
    const user = (localStorage.getItem('bian.user')||'');
    const who = document.getElementById('who'); if (who) who.textContent = user || 'Innlogget';
    const d = new Date();
    const subtitle = document.getElementById('subtitle');
    if (subtitle) subtitle.textContent = d.toLocaleDateString('no-NO',{weekday:'long', day:'2-digit', month:'long', year:'numeric'});
    const logoutBtn = document.getElementById('logout');
    if (logoutBtn) logoutBtn.addEventListener('click',()=>{ try{ localStorage.removeItem('bian.authed'); localStorage.removeItem('bian.user'); }catch(e){} window.location.href='login.html'; });

    // Periodevelger
    const toISODate = dt => new Date(dt.getTime()-dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
    const fromEl = document.getElementById('from');
    const toEl   = document.getElementById('to');
    const btn    = document.getElementById('save');
    const hint   = document.getElementById('hint');

    function setDefaults(){
      const qs = new URLSearchParams(location.search);
      const qsFrom = qs.get('from');
      const qsTo   = qs.get('to');
      const lsFrom = localStorage.getItem('bian.range.from');
      const lsTo   = localStorage.getItem('bian.range.to');

      // Default: siste 30 dager
      const now = new Date();
      const from = new Date(now); from.setDate(from.getDate()-29);
      fromEl.value = (qsFrom || lsFrom || toISODate(from));
      toEl.value   = (qsTo   || lsTo   || toISODate(now));
      validate();
    }

    function validate(){
      const f = fromEl.value, t = toEl.value;
      const ok = f && t && new Date(f) <= new Date(t);
      btn.disabled = !ok;
      hint.textContent = ok ? '' : 'Velg gyldige datoer (start før slutt).';
    }

    fromEl.addEventListener('change', validate);
    toEl.addEventListener('change', validate);

    btn.addEventListener('click', () => {
      const f = fromEl.value, t = toEl.value;
      localStorage.setItem('bian.range.from', f);
      localStorage.setItem('bian.range.to', t);
      const qs = new URLSearchParams({ from:f, to:t });
      history.replaceState({}, '', location.pathname + '?' + qs.toString());
      btn.blur();
    });

        setDefaults();

    // Hurtigvalg (I dag / 7 / 30)
    const presetBtns = Array.from(document.querySelectorAll('.chipbtn'));
    function toISO(d){return new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().slice(0,10)}
    function applyPreset(key){
      const now = new Date();
      let from = new Date(now);
      if(key==='day'){ /* samme dag */ }
      else if(key==='7'){ from.setDate(from.getDate()-6); }
      else if(key==='30'){ from.setDate(from.getDate()-29); }
      fromEl.value = toISO(from);
      toEl.value   = toISO(now);
      validate();
      updateActivePreset();
    }
    function updateActivePreset(){
      const f=new Date(fromEl.value), t=new Date(toEl.value);
      const now = new Date(); const sameDay = f.toDateString()===t.toDateString() && t.toDateString()===now.toDateString();
      const diffDays=Math.round((t-f)/86400000)+1; // inklusiv
      let key=null;
      if(sameDay) key='day'; else if(diffDays===7 && toISO(t)===toISO(now)) key='7'; else if(diffDays===30 && toISO(t)===toISO(now)) key='30';
      presetBtns.forEach(b=>b.classList.toggle('active', b.dataset.preset===key));
    }
    presetBtns.forEach(btn=>btn.addEventListener('click',()=>applyPreset(btn.dataset.preset)));
    fromEl.addEventListener('change', updateActivePreset);
    toEl.addEventListener('change', updateActivePreset);
    updateActivePreset();
  </script>
</body>
</html>
