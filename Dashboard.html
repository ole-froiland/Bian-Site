<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>Scope Dashboard</title>
  <script>
    (function(){
      if(!window.DASHBOARD_API_BASE){
        const explicit = document.documentElement?.getAttribute('data-api-base') || document.body?.getAttribute('data-api-base');
        if(explicit){
          window.DASHBOARD_API_BASE = explicit;
        }else{
          const host = (typeof window !== 'undefined' && window.location) ? window.location.hostname : '';
          const isLocal = ['localhost','127.0.0.1','0.0.0.0','::1'].includes(host);
          if(isLocal){
            window.DASHBOARD_API_BASE = 'http://localhost:8888';
          }else if (typeof window !== 'undefined' && window.location && window.location.origin){
            window.DASHBOARD_API_BASE = window.location.origin;
          }else{
            window.DASHBOARD_API_BASE = 'https://din-side.netlify.app';
          }
        }
      }
    })();
  </script>
  <style>
    *,*::before,*::after{box-sizing:border-box;}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      line-height:1.55;
      letter-spacing:0.01em;
      transition:background 0.3s ease,color 0.3s ease;
      /* Calmer indigo/slate palette (less purple) */
      --bg:#0b1020;                /* deep navy‑indigo */
      --surface:#141a2a;           /* neutral slate surface */
      --surface-raised:#1b2337;    /* raised surface */
      --border:rgba(148,163,184,0.22); /* cool slate border */
      --text:#e8ecf5;              /* soft off‑white */
      --text-strong:#ffffff;       /* strong text */
      --muted:#9aa6bd;             /* muted slate */
      --accent:#7d79f9;            /* subtle lilac accent */
      --accent-strong:#6c63d9;     /* deeper accent */
      --accent-soft:rgba(125,121,249,0.12); /* lighter glow */
      --positive:#34d399;
      --neutral:#fbbf24;
      --attention:#f87171;
      --brand-outline:rgba(125,121,249,0.4);
      --ring:0 0 0 3px rgba(125,121,249,0.55);
      --track-light:#e5e7eb;
      --track-dark:#374151;
      --card-radius:18px;
      color:var(--text);
      background:var(--bg);
      min-height:100vh;
      color-scheme:dark;
    }
    body[data-theme="light"]{
      --bg:#f6f7fb;                /* cool neutral */
      --surface:#ffffff;
      --surface-raised:#eef2ff;    /* very light indigo */
      --border:rgba(148,163,184,0.20);
      --text:#121826;              /* neutral indigo */
      --text-strong:#121826;
      --muted:#6b7280;
      --accent:#7d79f9;
      --accent-strong:#6c63d9;
      --accent-soft:rgba(125,121,249,0.10);
      --brand-outline:rgba(125,121,249,0.5);
      color-scheme:light;
    }
    h1,h2,h3,h4{margin:0;font-weight:600;color:var(--text-strong);}
    p{margin:0;}
    button{font:inherit;color:inherit;background:none;border:none;cursor:pointer;}
    button:focus-visible{outline:2px solid var(--accent);outline-offset:2px;}
    .shell{width:100%;max-width:1120px;margin:0 auto;padding-inline:clamp(16px,6vw,56px);}
    .top-bar{position:sticky;top:0;z-index:20;background:var(--surface);border-bottom:1px solid var(--border);box-shadow:0 18px 28px rgba(15,23,42,0.22);} 
    .top-bar__inner{display:flex;align-items:center;gap:clamp(12px,3vw,32px);min-height:74px;}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700;color:var(--text-strong);}
    .logo{display:grid;place-items:center;width:42px;height:42px;border-radius:14px;background:var(--surface-raised);border:1px solid var(--border);font-weight:700;letter-spacing:0.08em;}
    .brand-name{font-size:1.05rem;}
    .brand-title{flex:1;text-align:center;font-size:clamp(1.05rem,3vw,1.35rem);font-weight:600;}
    .nav-actions{display:flex;align-items:center;gap:12px;}
    .chip{border:1px solid var(--brand-outline);border-radius:999px;padding:0 16px;height:36px;min-width:52px;font-weight:700;background:var(--surface);color:inherit;text-decoration:none;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;font-size:15px;letter-spacing:.02em;box-shadow:0 1px 2px rgba(2,6,23,.06);transition:background-color .2s ease,border-color .2s ease,color .2s ease,transform .2s ease;will-change:background-color,border-color,color;backface-visibility:hidden;transform:translateZ(0);}
    .chip:focus-visible{outline:none;box-shadow:var(--ring);}
    .chip:hover{transform:translateY(-1px);border-color:var(--accent);background:var(--accent-soft);} 
    body[data-theme="dark"] .chip{background:var(--surface-raised);color:var(--text);border-color:rgba(125,121,249,0.45);} 
    .nav-actions .chip{height:40px;padding:0 18px;border-radius:20px;}
    .nav-actions .chip.user-menu__trigger{padding:0;min-width:40px;}
    .nav-actions .chip:not(.user-menu__trigger){min-width:60px;}
    .user-menu{position:relative;}
    .user-menu__trigger{width:40px;height:40px;min-width:40px;padding:0;border-radius:18px;border:1px solid var(--brand-outline);background:var(--surface);display:inline-flex;align-items:center;justify-content:center;box-shadow:0 10px 24px rgba(15,23,42,0.2);transition:background .22s ease,border-color .22s ease,transform .22s ease;}
    .user-menu__trigger:hover{transform:translateY(-1px);border-color:var(--accent);background:var(--accent-soft);}
    body[data-theme="light"] .user-menu__trigger{background:#ffffff;box-shadow:0 10px 18px rgba(31,41,55,0.08);} 
    body[data-theme="light"] .user-menu__trigger:hover{background:#f4f5ff;}
    .user-menu__icon{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;}
    .user-menu__icon span{display:block;width:18px;height:2px;border-radius:999px;background:var(--text);transition:background .22s ease;}
    .user-menu.open .user-menu__icon span{background:var(--accent-strong);}
    .user-menu__panel{position:absolute;top:calc(100% + 12px);right:0;min-width:220px;background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:0 20px 40px rgba(12,18,32,0.24);padding:10px 0;opacity:0;visibility:hidden;transform:translateY(-6px);transition:opacity .18s ease,transform .18s ease,visibility .18s ease;z-index:30;}
    body[data-theme="dark"] .user-menu__panel{background:var(--surface-raised);}
    .user-menu.open .user-menu__panel{opacity:1;visibility:visible;transform:translateY(0);}
    .user-menu__section-title{font-size:12px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);padding:6px 18px 4px;}
    .user-menu__item{width:100%;padding:10px 18px;text-align:left;background:none;border:none;font:inherit;color:var(--text);display:flex;align-items:center;gap:10px;cursor:pointer;text-decoration:none;transition:background .18s ease,color .18s ease;}
    .user-menu__item:hover{background:var(--accent-soft);color:var(--accent-strong);}
    .user-menu__item:focus-visible{outline:none;background:var(--accent-soft);color:var(--accent-strong);}
    .user-menu__item--danger{color:var(--attention);}
    .user-menu__item--danger:hover,
    .user-menu__item--danger:focus-visible{background:rgba(248,113,113,0.12);color:var(--attention);}
    .user-menu__separator{height:1px;background:var(--border);margin:8px 0;}
    /* Landing-page style theme switch */
    .theme-switch{position:relative;display:inline-flex;width:60px;height:40px;}
    .theme-switch input{opacity:0;width:0;height:0;}
    .theme-switch .slider{position:relative;cursor:pointer;display:block;width:100%;height:100%;background:var(--track-light);transition:background-color .20s ease,border-color .20s ease,left .20s ease,transform .20s ease;border-radius:9999px;box-shadow:0 2px 6px rgba(15,23,42,.18);border:1px solid var(--brand-outline);padding:4px;backface-visibility:hidden;transform:translateZ(0);} 
    .theme-switch input:focus-visible + .slider{box-shadow:var(--ring);} 
    body[data-theme="dark"] .theme-switch .slider{background:var(--track-dark);box-shadow:0 1px 2px rgba(255,255,255,.18);} 
    .theme-switch .thumb{position:absolute;top:50%;left:4px;width:26px;height:26px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .20s ease,border-color .20s ease,left .20s ease,transform .20s ease;border:1px solid var(--brand-outline);box-shadow:0 4px 12px rgba(15,23,42,.2);transform:translateY(-50%) translateZ(0);backface-visibility:hidden;} 
    .theme-switch .icon{width:16px;height:16px;stroke-width:2;} 
    .theme-switch .icon.sun{stroke:#FDB813;fill:none;} 
    .theme-switch .icon.moon{fill:#20354a;stroke:none;display:none;} 
    .theme-switch input:checked + .slider{background:var(--accent);} 
    .theme-switch input:checked + .slider .thumb{left:calc(100% - 4px);transform:translate(-100%,-50%) translateZ(0);} 
    .theme-switch input:checked + .slider .icon.sun{display:none;} 
    .theme-switch input:checked + .slider .icon.moon{display:block;} 
    .sub-nav{background:var(--bg);padding:clamp(18px,4vw,28px) 0 0;}
    .tablist{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;}
    .tab-button{padding:18px 20px;border-radius:16px;border:1px solid var(--border);background:var(--surface);font-size:1rem;font-weight:600;letter-spacing:0.02em;transition:background 0.25s ease,border-color 0.25s ease,box-shadow 0.25s ease,transform 0.25s ease;}
    .tab-button:hover{border-color:var(--accent);background:var(--surface-raised);transform:translateY(-1px);}
    .tab-button.active{background:var(--accent-soft);border-color:var(--accent);box-shadow:0 12px 24px rgba(125,121,249,0.18);} 
    main{width:100%;padding:clamp(24px,6vw,48px) 0 clamp(56px,10vw,96px);}
    .tab-panel{display:none;gap:clamp(18px,4vw,32px);}
    .tab-panel.active{display:grid;}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--card-radius);padding:clamp(18px,3vw,28px);box-shadow:0 24px 40px rgba(8,15,35,0.32);}
    .card header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:clamp(14px,2vw,20px);}
    .stats-grid{display:grid;gap:clamp(16px,3vw,24px);grid-template-columns:repeat(auto-fit,minmax(200px,1fr));}
    .stat-number{font-size:clamp(1.8rem,4vw,2.7rem);font-weight:700;color:var(--text-strong);margin-top:4px;}
    .stat-sub{margin-top:10px;font-size:0.95rem;color:var(--accent);}
    .table-scroll{overflow-x:auto;}
    table{width:100%;border-collapse:collapse;font-size:0.95rem;min-width:280px;}
    thead th{text-align:left;font-size:0.75rem;letter-spacing:0.08em;text-transform:uppercase;color:var(--muted);padding-bottom:10px;}
    tbody tr{border-top:1px solid var(--border);transition:background 0.25s ease;}
    tbody tr:first-child{border-top:none;}
    tbody tr:hover{background:rgba(148,163,184,0.08);}
    td,th{padding:12px 0;}
    td:last-child,th:last-child{text-align:right;}
    .chart-card{position:relative;}
    .chart-card .bar-chart{position:relative;display:grid;grid-template-columns:repeat(auto-fit,minmax(46px,1fr));gap:14px;align-items:end;height:240px;margin-top:18px;padding-bottom:18px;}
    .chart-card .bar-chart[data-empty="1"]{display:flex;align-items:center;justify-content:center;height:auto;min-height:120px;flex-direction:column;gap:6px;}
    .bar-chart__empty{font-size:0.9rem;color:var(--muted);text-align:center;}
    .chart-card .bar-chart[data-demo="1"]::after{
      content:'Viser demo-data. Sett Lightspeed-nøkler i Netlify for ekte tall.';
      position:absolute;inset:auto 0 0;transform:translateY(18px);
      font-size:0.7rem;color:var(--muted);text-align:center;
    }
    .bar-chart .bar{display:flex;flex-direction:column;align-items:center;justify-content:flex-end;gap:10px;text-align:center;color:var(--muted);height:100%;}
    .bar-chart .bar__column{width:100%;min-height:6px;border-radius:18px 18px 12px 12px;background:linear-gradient(180deg,var(--accent),var(--accent-strong));box-shadow:0 12px 30px rgba(14,165,233,0.25);transition:transform 0.25s ease;height:var(--height,6px);cursor:pointer;outline:none;}
    .bar-chart .bar__column:focus-visible{outline:2px solid var(--accent);outline-offset:2px;}
    .bar-chart .bar__column--zero{background:linear-gradient(180deg,rgba(148,163,184,0.4),rgba(99,102,241,0.35));box-shadow:none;opacity:0.6;}
    .bar-chart .bar__column:hover{transform:translateY(-4px);}
    .bar-chart .bar__label{display:flex;flex-direction:column;align-items:center;gap:2px;font-size:0.7rem;text-transform:uppercase;letter-spacing:0.08em;}
    .bar-chart .bar__label strong{font-weight:700;}
    .bar-chart .bar__label small{font-size:0.68rem;text-transform:none;letter-spacing:0.04em;color:var(--muted);}
    .chart-nav{display:flex;align-items:center;gap:8px;}
    .chart-nav__btn{width:32px;height:28px;border-radius:10px;border:1px solid var(--border);background:var(--surface-raised);color:inherit;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:16px;transition:background 0.2s ease,border-color 0.2s ease,transform 0.2s ease;cursor:pointer;}
    .chart-nav__btn:hover:not(:disabled){background:var(--accent-soft);border-color:var(--accent);transform:translateY(-1px);}
    .chart-nav__btn:disabled{opacity:0.4;cursor:not-allowed;transform:none;}
    .chart-tooltip{position:absolute;min-width:120px;max-width:220px;padding:8px 12px;border-radius:10px;background:rgba(28,35,56,0.92);color:#f8f9ff;font-size:0.75rem;font-weight:600;letter-spacing:0.01em;box-shadow:0 12px 32px rgba(15,23,42,0.45);pointer-events:none;opacity:0;transform:translate(-50%, -12px);transition:opacity 0.15s ease, transform 0.15s ease;z-index:3;}
    .chart-tooltip[data-visible="1"]{opacity:1;transform:translate(-50%, -16px);}
    .daily-summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;align-items:stretch;}
    .daily-summary__controls{display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
    .daily-summary__input{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:var(--surface);color:inherit;font:inherit;}
    .daily-summary__input:focus-visible{outline:none;box-shadow:var(--ring);}
    .daily-summary__status{grid-column:1/-1;font-size:0.85rem;color:var(--muted);margin-top:4px;}
    .summary-card{background:var(--surface-raised);border:1px solid rgba(148,163,184,0.18);border-radius:14px;padding:14px 16px;display:flex;flex-direction:column;gap:6px;box-shadow:none;}
    .summary-card__label{text-transform:uppercase;font-size:0.68rem;letter-spacing:0.14em;color:var(--muted);font-weight:600;margin:0;}
    .summary-card__value{font-size:clamp(1.3rem,2vw,1.8rem);font-weight:700;margin:0;color:var(--text-strong);}
    .summary-card__meta{font-size:0.82rem;color:var(--muted);}
    .tips-list{list-style:none;margin:0;padding:0;display:grid;gap:clamp(14px,3vw,20px);}
    .tips-list li{display:flex;flex-direction:column;gap:12px;padding:clamp(14px,3vw,22px);border-radius:14px;background:var(--surface-raised);border:1px solid rgba(148,163,184,0.16);}
    body[data-theme="light"] .tips-list li{background:rgba(148,163,184,0.12);}
    .tip-body{font-size:1rem;color:var(--text);}
    .tip-tags{display:flex;flex-wrap:wrap;gap:8px;}
    .tip-tags .chip{display:inline-flex;align-items:center;justify-content:center;padding:0 14px;height:30px;border-radius:999px;font-size:0.85rem;font-weight:600;border:1px solid transparent;letter-spacing:0.02em;}
    .tip-tags .chip.positive{color:var(--positive);background:rgba(52,211,153,0.18);border-color:rgba(52,211,153,0.24);}
    .tip-tags .chip.neutral{color:var(--neutral);background:rgba(251,191,36,0.18);border-color:rgba(251,191,36,0.3);}
    .tip-tags .chip.attention{color:var(--attention);background:rgba(248,113,113,0.18);border-color:rgba(248,113,113,0.3);}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;}
    @media (max-width:960px){
      .brand-title{font-size:1.15rem;}
      .tablist{grid-template-columns:repeat(3,minmax(0,1fr));}
    }
    @media (max-width:760px){
      .top-bar__inner{flex-wrap:wrap;justify-content:space-between;}
      .brand{order:1;}
      .brand-title{order:2;flex-basis:100%;text-align:center;}
      .nav-actions{order:3;width:100%;justify-content:center;gap:12px;}
      .sub-nav{padding-top:18px;}
      .tablist{grid-template-columns:repeat(auto-fit,minmax(160px,1fr));}
    }
    @media (max-width:520px){
      .shell{padding-inline:16px;}
      .top-bar__inner{gap:18px;}
      .nav-actions{flex-wrap:wrap;}
      .tablist{grid-template-columns:1fr;}
      .tab-button{text-align:center;}
      .tips-list li{padding:18px;}
    }
    @media (prefers-reduced-motion:reduce){
      *,*::before,*::after{animation-duration:0.01ms!important;animation-iteration-count:1!important;transition-duration:0.01ms!important;scroll-behavior:auto!important;}
    }
  </style>
</head>
<body data-theme="dark">
  <header class="top-bar">
    <div class="shell top-bar__inner">
      <div class="brand">
        <span class="logo">S</span>
        <span class="brand-name">Scope</span>
      </div>
      <div class="brand-title">Gressholmen Kro</div>
      <div class="nav-actions">
        <div class="user-menu" data-menu>
          <button type="button" id="user-menu-trigger" class="chip user-menu__trigger" aria-haspopup="true" aria-expanded="false" aria-controls="user-menu-panel" aria-label="Konto og innstillinger">
            <span class="sr-only">Din konto</span>
            <span class="user-menu__icon" aria-hidden="true">
              <span></span>
              <span></span>
              <span></span>
            </span>
          </button>
          <div class="user-menu__panel" id="user-menu-panel" role="menu" aria-labelledby="user-menu-trigger" hidden>
            <div class="user-menu__section-title">Konto</div>
            <button type="button" class="user-menu__item" role="menuitem">Betaling &amp; faktura</button>
            <button type="button" class="user-menu__item" role="menuitem">Innstillinger</button>
            <div class="user-menu__separator" role="presentation"></div>
            <button type="button" class="user-menu__item user-menu__item--danger" role="menuitem">Logg ut</button>
          </div>
        </div>
        <button type="button" class="chip" aria-label="Bytt til engelsk">EN</button>
        <label class="theme-switch" aria-label="Bytt tema">
          <input type="checkbox" id="dash-theme-toggle" aria-label="Tema" />
          <span class="slider">
            <span class="thumb">
              <svg class="icon sun" viewBox="0 0 24 24" aria-hidden="true">
                <circle cx="12" cy="12" r="5" />
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <svg class="icon moon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z" />
              </svg>
            </span>
          </span>
        </label>
      </div>
    </div>
  </header>
  <nav class="sub-nav">
    <div class="shell tablist" role="tablist" aria-label="Dashboard faner">
      <button class="tab-button active" id="tab-kpi" type="button" role="tab" aria-selected="true" aria-controls="kpi" data-tab-target="kpi" tabindex="0">KPI-er</button>
      <button class="tab-button" id="tab-oversikt" type="button" role="tab" aria-selected="false" aria-controls="oversikt" data-tab-target="oversikt" tabindex="-1">Oversikt</button>
      <button class="tab-button" id="tab-ai" type="button" role="tab" aria-selected="false" aria-controls="ai-tips" data-tab-target="ai-tips" tabindex="-1">AI-tips</button>
    </div>
    
  </nav>
  <main class="shell">
    <section class="tab-panel active" id="kpi" role="tabpanel" aria-labelledby="tab-kpi" tabindex="0">
      <div class="stats-grid">
        <article class="card stat">
          <h2>Daglig omsetning</h2>
          <p class="stat-number">134&nbsp;560 kr</p>
          <p class="stat-sub">+12% siden i går</p>
        </article>
        <article class="card stat">
          <h2>Gjennomsnittlig besøk</h2>
          <p class="stat-number">286 gjester</p>
          <p class="stat-sub">+8% siste uke</p>
        </article>
        <article class="card stat">
          <h2>Snittordre</h2>
          <p class="stat-number">472 kr</p>
          <p class="stat-sub">+5% siste 14 dager</p>
        </article>
      </div>
      <article class="card table-card">
        <header>
          <h2>Topp 3 produkter</h2>
        </header>
        <div class="table-scroll">
          <table>
            <thead>
              <tr>
                <th>Produkt</th>
                <th>Solgt</th>
                <th>Andel</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Grillet kveite</td>
                <td>184</td>
                <td>32%</td>
              </tr>
              <tr>
                <td>Fersk blåskjell</td>
                <td>156</td>
                <td>27%</td>
              </tr>
              <tr>
                <td>Bryggens burger</td>
                <td>142</td>
                <td>24%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </article>
    </section>
    <section class="tab-panel" id="oversikt" role="tabpanel" aria-labelledby="tab-oversikt" tabindex="0" hidden>
      <article class="card chart-card">
        <header>
          <h2>Omsetning (14 dager)</h2>
          <div class="chart-nav">
            <button type="button" class="chart-nav__btn" data-chart-nav="prev" aria-label="Forrige 14 dager">‹</button>
            <button type="button" class="chart-nav__btn" data-chart-nav="next" aria-label="Neste 14 dager">›</button>
          </div>
        </header>
        <div class="bar-chart" data-daily-chart role="img" aria-live="polite" aria-label="Omsetning siste 14 dager"></div>
        <div class="chart-tooltip" data-chart-tooltip hidden></div>
      </article>
      <article class="card daily-summary-card">
        <header>
          <h2>Dagens omsetning</h2>
          <div class="daily-summary__controls">
            <label for="sales-day-picker" class="sr-only">Velg dato</label>
            <input type="date" id="sales-day-picker" class="daily-summary__input" />
          </div>
        </header>
        <div class="daily-summary">
          <article class="summary-card">
            <span class="summary-card__label">Dagens omsetning</span>
            <p class="summary-card__value" data-day-revenue>–</p>
            <span class="summary-card__meta" data-day-date> </span>
          </article>
          <article class="summary-card">
            <span class="summary-card__label">Kvitteringer</span>
            <p class="summary-card__value" data-day-receipts>–</p>
            <span class="summary-card__meta" data-day-guests> </span>
          </article>
          <article class="summary-card">
            <span class="summary-card__label">Snitt per kjøp</span>
            <p class="summary-card__value" data-day-average>–</p>
            <span class="summary-card__meta" data-day-average-meta> </span>
          </article>
          <div class="daily-summary__status" data-day-status></div>
        </div>
      </article>
      <article class="card table-card">
        <header>
          <h2>Omsetning per dag</h2>
        </header>
        <div class="table-scroll">
          <table>
            <thead>
              <tr>
                <th>Dato</th>
                <th>Omsetning</th>
                <th>Gjester</th>
              </tr>
            </thead>
            <tbody id="daily-sales-body">
              <tr class="demo-row">
                <td>12. mai</td>
                <td>128&nbsp;900 kr</td>
                <td>302</td>
              </tr>
              <tr class="demo-row">
                <td>11. mai</td>
                <td>142&nbsp;100 kr</td>
                <td>318</td>
              </tr>
              <tr class="demo-row">
                <td>10. mai</td>
                <td>119&nbsp;450 kr</td>
                <td>276</td>
              </tr>
              <tr class="demo-row">
                <td>9. mai</td>
                <td>105&nbsp;780 kr</td>
                <td>244</td>
              </tr>
              <tr class="demo-row">
                <td>8. mai</td>
                <td>131&nbsp;060 kr</td>
                <td>289</td>
              </tr>
              <tr class="demo-row">
                <td>7. mai</td>
                <td>138&nbsp;500 kr</td>
                <td>310</td>
              </tr>
              <tr class="demo-row">
                <td>6. mai</td>
                <td>114&nbsp;230 kr</td>
                <td>268</td>
              </tr>
            </tbody>
          </table>
        </div>
      </article>
    </section>
    <section class="tab-panel" id="ai-tips" role="tabpanel" aria-labelledby="tab-ai" tabindex="0" hidden>
      <article class="card tips-card">
        <header>
          <h2>AI-tips</h2>
        </header>
        <ul class="tips-list">
          <li>
            <div class="tip-body">Bruk AI til å teste alternative menybeskrivelser og fremhev råvarer for å øke bestillinger på premium-retter.</div>
            <div class="tip-tags">
              <span class="chip positive">Potensial: Høy</span>
              <span class="chip neutral">Effekt: Middels</span>
            </div>
          </li>
          <li>
            <div class="tip-body">Analyser værvarsel og bookingdata for å justere bemanningen automatisk før helgetopper.</div>
            <div class="tip-tags">
              <span class="chip positive">Potensial: Middels</span>
              <span class="chip attention">Effekt: Høy</span>
            </div>
          </li>
          <li>
            <div class="tip-body">La AI foreslå mersalgsforslag til servitørene basert på gjestenes historikk og favoritter.</div>
            <div class="tip-tags">
              <span class="chip positive">Potensial: Høy</span>
              <span class="chip neutral">Effekt: Lav</span>
            </div>
          </li>
        </ul>
      </article>
    </section>
  </main>
  <script>
    (function() {
      const buttons = Array.from(document.querySelectorAll('.tab-button'));
      const panels = Array.from(document.querySelectorAll('.tab-panel'));

      function activateTab(targetId) {
        buttons.forEach((btn) => {
          const isActive = btn.dataset.tabTarget === targetId;
          btn.classList.toggle('active', isActive);
          btn.setAttribute('aria-selected', String(isActive));
          btn.setAttribute('tabindex', isActive ? '0' : '-1');
        });

        panels.forEach((panel) => {
          const isMatch = panel.id === targetId;
          panel.classList.toggle('active', isMatch);
          panel.toggleAttribute('hidden', !isMatch);
        });

      }

      // simple tab controller for switching dashboard sections
      buttons.forEach((btn) => {
        btn.addEventListener('click', () => activateTab(btn.dataset.tabTarget));
        btn.addEventListener('keydown', (event) => {
          const index = buttons.indexOf(btn);
          if (event.key === 'ArrowRight' || event.key === 'ArrowLeft') {
            event.preventDefault();
            const direction = event.key === 'ArrowRight' ? 1 : -1;
            const nextIndex = (index + direction + buttons.length) % buttons.length;
            buttons[nextIndex].focus();
          } else if (event.key === 'Home') {
            event.preventDefault();
            buttons[0].focus();
          } else if (event.key === 'End') {
            event.preventDefault();
            buttons[buttons.length - 1].focus();
          }
        });
      });

      const defaultTab = buttons.find((btn) => btn.classList.contains('active'))?.dataset.tabTarget || buttons[0]?.dataset.tabTarget;
      if (defaultTab) {
        activateTab(defaultTab);
      }

      const moneyFmt = new Intl.NumberFormat('nb-NO', { style: 'currency', currency: 'NOK', maximumFractionDigits: 0 });
      const qtyFmt = new Intl.NumberFormat('nb-NO', { maximumFractionDigits: 0 });
      const dateFmtShort = new Intl.DateTimeFormat('nb-NO', { day: 'numeric', month: 'short' });
      const dateFmtLong = new Intl.DateTimeFormat('nb-NO', { weekday: 'short', day: 'numeric', month: 'short' });

      const apiBase = window.DASHBOARD_API_BASE || (
        (window.location && window.location.origin) ? window.location.origin : 'http://localhost:8888'
      );

      const toISODate = (date) => {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      };

      const today = new Date();
      const todayISO = toISODate(today);

      const dayPicker = document.querySelector('#sales-day-picker');
      const dayRevenueEl = document.querySelector('[data-day-revenue]');
      const dayGuestsEl = document.querySelector('[data-day-guests]');
      const dayReceiptsEl = document.querySelector('[data-day-receipts]');
      const dayAverageEl = document.querySelector('[data-day-average]');
      const dayAverageMetaEl = document.querySelector('[data-day-average-meta]');
      const dayDateEl = document.querySelector('[data-day-date]');
      const dayStatusEl = document.querySelector('[data-day-status]');
      const barChart = document.querySelector('[data-daily-chart]');
      const chartPrevBtn = document.querySelector('[data-chart-nav="prev"]');
      const chartNextBtn = document.querySelector('[data-chart-nav="next"]');
      const chartTooltip = document.querySelector('[data-chart-tooltip]');
      const chartCard = barChart ? barChart.closest('.chart-card') : null;
      const weekdayFmt = new Intl.DateTimeFormat('nb-NO', { weekday: 'short' });
      const chartDateFmt = new Intl.DateTimeFormat('nb-NO', { day: '2-digit', month: '2-digit' });

      const renderDayStatus = (message, tone = 'muted') => {
        if (!dayStatusEl) return;
        dayStatusEl.textContent = message || '';
        dayStatusEl.dataset.tone = tone;
      };

      const hideGlobalTooltip = () => {
        if (!chartTooltip) return;
        chartTooltip.dataset.visible = '0';
        chartTooltip.hidden = true;
      };

      const renderDayTotals = ({ date, revenue, guests, receipts }, { isDemo = false } = {}) => {
        if (!dayRevenueEl) return;
        const parsed = date ? new Date(`${date}T00:00:00`) : null;
        const friendly = parsed && !Number.isNaN(parsed.getTime()) ? dateFmtLong.format(parsed) : date || '–';
        dayRevenueEl.textContent = moneyFmt.format(Number(revenue || 0));
        dayGuestsEl.textContent = `${qtyFmt.format(Number(guests || 0))} gjester`;
        dayReceiptsEl.textContent = `${qtyFmt.format(Number(receipts || 0))} kvitteringer`;
        renderDayStatus(isDemo ? `Viser demo for ${friendly} (mangler Lightspeed-nøkler).` : `Tall for ${friendly}`);
      };

      const fetchDayTotals = (date, { demo = false } = {}) => {
        const url = new URL('/.netlify/functions/lightspeed', apiBase);
        url.searchParams.set('date', date);
        if (demo) url.searchParams.set('demo', '1');
        return fetch(url.toString(), { headers: { accept: 'application/json' } })
          .then(async (response) => {
            const payload = await response.json().catch(() => null);
            if (!response.ok) {
              const error = new Error(`HTTP ${response.status}`);
              error.status = response.status;
              error.body = payload;
              throw error;
            }
            return payload;
          });
      };

      const loadDayTotals = (date) => {
        if (!dayRevenueEl) return;
        renderDayStatus('Henter omsetning ...');
        dayRevenueEl.textContent = '–';
        dayGuestsEl.textContent = '– gjester';
        dayReceiptsEl.textContent = '– kvitteringer';

        let attemptedDemo = false;

        const attempt = (options = {}) => {
          fetchDayTotals(date, options)
            .then((data) => {
              if (data?.dayTotal) {
                renderDayTotals(data.dayTotal, { isDemo: !!options.demo });
                return;
              }
              const daily = Array.isArray(data?.daily) ? data.daily : [];
              const match = daily.find((d) => d.date === date);
              if (match) {
                renderDayTotals(match, { isDemo: !!options.demo });
              } else if (daily.length) {
                renderDayTotals(daily[0], { isDemo: !!options.demo });
              } else {
                renderDayStatus('Ingen omsetning funnet for valgt dato.');
              }
            })
            .catch((error) => {
              console.error('Kunne ikke hente dagsomsetning:', error);
              const allowDemo = !attemptedDemo && error?.status === 400 &&
                (error?.body?.error === 'CONFIG_MISSING' || error?.body?.error === 'RECEIPTS_FAIL');
              if (allowDemo) {
                attemptedDemo = true;
                attempt({ demo: true });
                return;
              }
              if (attemptedDemo && options.demo && error?.body?.dayTotal) {
                renderDayTotals(error.body.dayTotal, { isDemo: true });
                return;
              }
              renderDayStatus(error?.body?.message || error?.message || 'Feil ved henting av omsetning', 'error');
            });
        };

        attempt();
      };

      if (barChart) {
        barChart.addEventListener('mouseleave', hideGlobalTooltip);
      }

      if (dayPicker) {
        dayPicker.max = todayISO;
        if (!dayPicker.value) dayPicker.value = todayISO;
        loadDayTotals(dayPicker.value);
        dayPicker.addEventListener('change', () => {
          const date = dayPicker.value || todayISO;
          loadDayTotals(date);
        });
      }

      const dailyTableBody = document.querySelector('#daily-sales-body');
      if (dailyTableBody && typeof fetch === 'function') {
        const fallbackHtml = dailyTableBody.innerHTML;

        const renderLoading = () => {
          const loadingRow = document.createElement('tr');
          loadingRow.innerHTML = '<td colspan="3">Henter omsetning …</td>';
          dailyTableBody.innerHTML = '';
          dailyTableBody.appendChild(loadingRow);
        };

      const renderChart = (days, { isDemo = false, message = '' } = {}) => {
        if (!barChart) return;
        barChart.innerHTML = '';
        if (chartTooltip) {
          chartTooltip.hidden = true;
          chartTooltip.dataset.visible = '0';
        }
        if (!Array.isArray(days) || !days.length) {
          barChart.dataset.empty = '1';
          barChart.removeAttribute('data-demo');
          barChart.innerHTML = `<div class="bar-chart__empty">${message || 'Ingen data'}</div>`;
          return;
          }

          const revenues = days.map(d => Math.max(0, Number(d.revenue || 0)));
          const maxRevenue = Math.max(...revenues, 0) || 1;
          const nonZeroRevenues = revenues.filter(n => n > 0);
          const minRevenue = nonZeroRevenues.length ? Math.min(...nonZeroRevenues) : 0;
          const stretchFactor = 0.6;
          const chartHeight = barChart.clientHeight || 240;
          const maxBarHeight = chartHeight * 0.9;
          const minBarHeight = Math.max(6, chartHeight * 0.05);

          barChart.removeAttribute('data-empty');
          if (isDemo) {
            barChart.dataset.demo = '1';
          } else {
            barChart.removeAttribute('data-demo');
          }

          const showTooltip = (barEl, friendly, revenue) => {
            if (!chartTooltip) return;
            const containerRect = chartCard?.getBoundingClientRect() || barChart.getBoundingClientRect();
            const barRect = barEl.getBoundingClientRect();
            const left = barRect.left + barRect.width / 2 - containerRect.left;
            const top = barRect.top - containerRect.top;
            chartTooltip.textContent = `${friendly}: ${moneyFmt.format(revenue)}`;
            chartTooltip.style.left = `${left}px`;
            chartTooltip.style.top = `${top}px`;
            chartTooltip.hidden = false;
            chartTooltip.dataset.visible = '1';
          };

          const hideTooltip = () => {
            if (!chartTooltip) return;
            chartTooltip.dataset.visible = '0';
            chartTooltip.hidden = true;
          };

          days.forEach((day) => {
            const revenue = Math.max(0, Number(day.revenue || 0));
            let ratio = 0;
            if (revenue > 0) {
              const scaled = (revenue - minRevenue) * stretchFactor;
              ratio = (minRevenue + scaled) / Math.max(maxRevenue, 1);
            }
            ratio = Math.max(0, Math.min(1, ratio));
            const column = document.createElement('div');
            column.className = 'bar__column';
            const columnHeight = Math.max(minBarHeight, ratio * maxBarHeight);
            column.style.setProperty('--height', `${columnHeight}px`);
            const bar = document.createElement('div');
            bar.className = 'bar';
            const dateObj = day.date ? new Date(`${day.date}T00:00:00`) : null;
            const dayNameRaw = dateObj && !Number.isNaN(dateObj.getTime()) ? weekdayFmt.format(dateObj) : '';
            const dayName = dayNameRaw ? dayNameRaw.replace('.', '').slice(0,3).toUpperCase() : '';
            const dateLabel = dateObj && !Number.isNaN(dateObj.getTime()) ? chartDateFmt.format(dateObj) : (day.date || '');
            const friendly = dateObj && !Number.isNaN(dateObj.getTime()) ? dateFmtLong.format(dateObj) : (day.date || '');
            bar.title = `${friendly}: ${moneyFmt.format(revenue)}`;
            if (!revenue) {
              column.classList.add('bar__column--zero');
            }
            const label = document.createElement('span');
            label.className = 'bar__label';
            label.innerHTML = `<strong>${dayName}</strong><small>${dateLabel}</small>`;
            bar.append(column, label);
            const eventTarget = column;
            const handleEnter = () => showTooltip(bar, friendly, revenue);
            const handleLeave = () => hideTooltip();
            eventTarget.addEventListener('mouseenter', handleEnter);
            eventTarget.addEventListener('mouseleave', handleLeave);
            eventTarget.addEventListener('focus', handleEnter);
            eventTarget.addEventListener('blur', handleLeave);
            eventTarget.tabIndex = 0;
            eventTarget.setAttribute('aria-label', `${friendly}: ${moneyFmt.format(revenue)}`);
            barChart.appendChild(bar);
          });
        };

        const renderRows = (days, { showDemoNotice = false } = {}) => {
          dailyTableBody.innerHTML = '';
          if (!Array.isArray(days) || !days.length) {
            renderError('Ingen data', { replace: true });
            return;
          }
          if (showDemoNotice) {
            const notice = document.createElement('tr');
            notice.innerHTML = '<td colspan="3">Viser demo-data. Sett Lightspeed-nøkler i Netlify for ekte tall.</td>';
            dailyTableBody.appendChild(notice);
          }
          days.slice(0, 7).forEach((entry) => {
            const dateStr = typeof entry?.date === 'string' ? entry.date : null;
            const displayDate = (() => {
              if (!dateStr) return '–';
              const parsed = new Date(`${dateStr}T00:00:00`);
              if (Number.isNaN(parsed.getTime())) return dateStr;
              return dateFmtShort.format(parsed);
            })();
            const revenue = Number(entry?.revenue || 0);
            const guests = Number(entry?.guests || entry?.guestCount || 0);
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${displayDate}</td>
              <td>${moneyFmt.format(revenue)}</td>
              <td>${guests > 0 ? qtyFmt.format(guests) : '–'}</td>
            `;
            dailyTableBody.appendChild(row);
          });
        };

        const renderError = (message, { replace = false } = {}) => {
          if (replace) dailyTableBody.innerHTML = '';
          const row = document.createElement('tr');
          row.innerHTML = `<td colspan="3">${message}</td>`;
          dailyTableBody.appendChild(row);
        };

      const chartWindowDays = 14;
      let chartDataAll = [];
      let chartDataMap = new Map();
      let chartCursorDate = null;
      let chartLatestDate = todayISO;
      let chartOldestDate = todayISO;
      let chartIsDemo = false;

        const addDaysISO = (iso, delta) => {
          const base = iso ? new Date(`${iso}T00:00:00`) : new Date(`${todayISO}T00:00:00`);
          if (Number.isNaN(base.getTime())) return toISODate(new Date(`${todayISO}T00:00:00`));
          base.setDate(base.getDate() + delta);
          return toISODate(base);
        };

        const clampCursorDate = (iso) => {
          const latest = chartDataAll.length ? chartDataAll[0].date : todayISO;
          const oldest = chartDataAll.length ? chartDataAll[chartDataAll.length - 1].date : latest;
          const earliestEnd = chartDataAll.length >= chartWindowDays ? addDaysISO(oldest, chartWindowDays - 1) : latest;
          let target = iso || latest;
          if (target.localeCompare(latest) > 0) target = latest;
          if (target.localeCompare(earliestEnd) < 0) target = earliestEnd;
          return target;
        };

        const buildChartRange = (endIso) => {
          const cursor = clampCursorDate(endIso);
          const endDate = new Date(`${cursor}T00:00:00`);
          const startDate = new Date(endDate);
          startDate.setDate(startDate.getDate() - (chartWindowDays - 1));
          const range = [];
          for (let i = 0; i < chartWindowDays; i++) {
            const current = new Date(startDate);
            current.setDate(startDate.getDate() + i);
            const iso = toISODate(current);
            const entry = chartDataMap.get(iso) || { date: iso, revenue: 0, guests: 0, receipts: 0 };
            range.push(entry);
          }
          return { cursor, range };
        };

        const updateChartNavButtons = () => {
          if (!chartPrevBtn || !chartNextBtn) return;
          if (!chartDataAll.length) {
            chartPrevBtn.disabled = true;
            chartNextBtn.disabled = true;
            return;
          }
          const latest = chartDataAll[0]?.date || todayISO;
          const oldest = chartDataAll[chartDataAll.length - 1]?.date || latest;
          const earliestEnd = chartDataAll.length >= chartWindowDays ? addDaysISO(oldest, chartWindowDays - 1) : latest;
          chartPrevBtn.disabled = chartCursorDate ? chartCursorDate.localeCompare(earliestEnd) <= 0 : true;
          chartNextBtn.disabled = chartCursorDate ? chartCursorDate.localeCompare(latest) >= 0 : false;
        };

        const renderChartWindow = (endIso, { isDemo = false } = {}) => {
          const { cursor, range } = buildChartRange(endIso);
          chartCursorDate = cursor;
          renderChart(range, { isDemo });
          updateChartNavButtons();
        };

        const shiftChartWindow = (offsetDays) => {
          if (!chartCursorDate) return;
          hideGlobalTooltip();
          const target = addDaysISO(chartCursorDate, offsetDays);
          renderChartWindow(target, { isDemo: chartIsDemo });
        };

        const fromDate = new Date(today);
        fromDate.setDate(fromDate.getDate() - 60);
        const from = toISODate(fromDate);

        const fetchDaily = ({ demo = false } = {}) => {
          const url = new URL('/.netlify/functions/lightspeed', apiBase);
          url.searchParams.set('from', from);
          url.searchParams.set('to', todayISO);
          url.searchParams.set('group', 'daily');
          url.searchParams.set('limit', '90');
          url.searchParams.set('window', '90');
          if (demo) url.searchParams.set('demo', '1');

          return fetch(url.toString(), { headers: { accept: 'application/json' } })
            .then(async (response) => {
              const payload = await response.json().catch(() => null);
              if (!response.ok) {
                const error = new Error(`HTTP ${response.status}`);
                error.status = response.status;
                error.body = payload;
                throw error;
              }
              return payload;
            });
        };

        let attemptedDemoFallback = false;
        renderLoading();
        renderChart([], { message: 'Henter …' });
        updateChartNavButtons();

        const load = (options = {}) => {
          fetchDaily(options)
            .then((data) => {
              const days = Array.isArray(data?.daily) ? data.daily : [];
              const isDemo = !!options.demo || data?.mode === 'demo';
              const sortedDesc = [...days].sort((a, b) => b.date.localeCompare(a.date));
              renderRows(sortedDesc, { showDemoNotice: isDemo });
              chartDataAll = sortedDesc;
              chartDataMap = new Map(sortedDesc.map(entry => [entry.date, entry]));
              chartLatestDate = chartDataAll.length ? chartDataAll[0].date : todayISO;
              chartOldestDate = chartDataAll.length ? chartDataAll[chartDataAll.length - 1].date : chartLatestDate;
              chartIsDemo = isDemo;
              renderChartWindow(chartLatestDate, { isDemo });
            })
            .catch((error) => {
              console.error('Kunne ikke hente daglig omsetning:', error);
              const shouldTryDemo = !attemptedDemoFallback && (
                error?.status === 400 &&
                (error?.body?.error === 'CONFIG_MISSING' || error?.body?.error === 'RECEIPTS_FAIL')
              );
              if (shouldTryDemo) {
                attemptedDemoFallback = true;
                renderLoading();
                load({ demo: true });
                return;
              }
              if (attemptedDemoFallback && options.demo) {
                try {
                  const days = error?.body?.daily || [];
                  const sortedDesc = [...days].sort((a, b) => b.date.localeCompare(a.date));
                  renderRows(sortedDesc, { showDemoNotice: true });
                  chartDataAll = sortedDesc;
                  chartDataMap = new Map(sortedDesc.map(entry => [entry.date, entry]));
                  chartLatestDate = chartDataAll.length ? chartDataAll[0].date : todayISO;
                  chartOldestDate = chartDataAll.length ? chartDataAll[chartDataAll.length - 1].date : chartLatestDate;
                  chartIsDemo = true;
                  renderChartWindow(chartLatestDate, { isDemo: true });
                  return;
                } catch (_) {
                  /* fall through */
                }
              }
              dailyTableBody.innerHTML = fallbackHtml;
              renderError(
                (error?.body?.message) ? `Kunne ikke hente daglig omsetning: ${error.body.message}`
                  : `Kunne ikke hente daglig omsetning. ${error?.message || ''}`,
                { replace: false }
              );
              chartDataAll = [];
              chartDataMap = new Map();
              chartCursorDate = null;
              chartLatestDate = todayISO;
              chartOldestDate = todayISO;
              chartIsDemo = false;
              renderChart([], { message: error?.body?.message || error?.message || 'Feil ved henting' });
              updateChartNavButtons();
            });
        };

        if (chartPrevBtn) {
          chartPrevBtn.addEventListener('click', () => shiftChartWindow(-chartWindowDays));
        }
        if (chartNextBtn) {
          chartNextBtn.addEventListener('click', () => shiftChartWindow(chartWindowDays));
        }

        load();
      }

      const themeToggleInput = document.querySelector('#dash-theme-toggle');
      if (themeToggleInput) {
        const isDark = document.body.getAttribute('data-theme') !== 'light';
        themeToggleInput.checked = isDark;
        themeToggleInput.addEventListener('change', () => {
          const toDark = themeToggleInput.checked;
          document.body.setAttribute('data-theme', toDark ? 'dark' : 'light');
        });
      }

      const userMenu = document.querySelector('[data-menu]');
      if (userMenu) {
        const trigger = userMenu.querySelector('.user-menu__trigger');
        const panel = userMenu.querySelector('.user-menu__panel');
        const items = Array.from(userMenu.querySelectorAll('.user-menu__item'));

        const setOpen = (open) => {
          userMenu.classList.toggle('open', open);
          trigger.setAttribute('aria-expanded', String(open));
          panel.toggleAttribute('hidden', !open);
          if (open) {
            requestAnimationFrame(() => items[0]?.focus());
          }
        };

        trigger.addEventListener('click', (event) => {
          event.preventDefault();
          const open = !userMenu.classList.contains('open');
          setOpen(open);
        });

        trigger.addEventListener('keydown', (event) => {
          if (event.key === 'ArrowDown') {
            event.preventDefault();
            if (!userMenu.classList.contains('open')) {
              setOpen(true);
            } else {
              items[0]?.focus();
            }
          } else if (event.key === 'Escape') {
            setOpen(false);
            trigger.focus();
          }
        });

        items.forEach((item, index) => {
          item.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowDown' || event.key === 'ArrowUp') {
              event.preventDefault();
              const direction = event.key === 'ArrowDown' ? 1 : -1;
              const nextIndex = (index + direction + items.length) % items.length;
              items[nextIndex].focus();
            } else if (event.key === 'Escape') {
              setOpen(false);
              trigger.focus();
            }
          });

          item.addEventListener('click', () => {
            setOpen(false);
            trigger.focus();
          });
        });

        document.addEventListener('click', (event) => {
          if (!userMenu.contains(event.target)) {
            setOpen(false);
          }
        });

        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && userMenu.classList.contains('open')) {
            setOpen(false);
            trigger.focus();
          }
        });
      }
    })();
  </script>
</body>
</html>
