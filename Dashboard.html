<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Velg periode — Gressholmen Kro AS</title>
  <style>
    :root{--border:#e5e7eb;--ink:#0b1220}
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;color:var(--ink);background:#fff}
    .container{min-height:100vh;display:grid;place-items:center;padding:24px}
    .card{width:min(560px,96vw);border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 10px 28px rgba(2,6,23,.06)}
    h1{margin:0 0 14px;font-size:20px;letter-spacing:-.01em}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;font-weight:600;font-size:.92rem;margin-bottom:6px}
    input[type="date"]{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff}
    .actions{display:flex;justify-content:flex-end;gap:10px;margin-top:16px}
    button{appearance:none;border:1px solid var(--border);border-radius:12px;padding:10px 16px;background:#111827;color:#fff;font-weight:700;cursor:pointer}
    button:disabled{opacity:.55;cursor:not-allowed}
    small{display:block;color:#6b7280;margin-top:6px}
  </style>

  <!-- Behold enkel auth-guard. Fjern denne blokken hvis du ikke vil ha innlogging. -->
  <script>
    (function(){
      try{
        const authed = localStorage.getItem('bian.authed') === '1';
        const user = (localStorage.getItem('bian.user')||'').toLowerCase();
        if(!authed || user!=='test@gressholmen.no'){
          window.location.replace('login.html');
        }
      }catch(e){ window.location.replace('login.html'); }
    })();
  </script>
</head>
<body>
  <main class="container">
    <section class="card" aria-label="Velg periode">
      <h1>Velg periode</h1>
      <div class="row">
        <div>
          <label for="from">Start</label>
          <input id="from" type="date" autocomplete="off">
        </div>
        <div>
          <label for="to">Slutt</label>
          <input id="to" type="date" autocomplete="off">
        </div>
      </div>
      <div class="actions">
        <button id="save" disabled>Bruk</button>
      </div>
      <small id="hint"></small>
    </section>
  </main>

  <script>
    const toISODate = d => new Date(d.getTime()-d.getTimezoneOffset()*60000).toISOString().slice(0,10);
    const fromEl = document.getElementById('from');
    const toEl   = document.getElementById('to');
    const btn    = document.getElementById('save');
    const hint   = document.getElementById('hint');

    function setDefaults(){
      const qs = new URLSearchParams(location.search);
      const qsFrom = qs.get('from');
      const qsTo   = qs.get('to');
      const lsFrom = localStorage.getItem('bian.range.from');
      const lsTo   = localStorage.getItem('bian.range.to');

      // Default: siste 30 dager
      const now = new Date();
      const from = new Date(now); from.setDate(from.getDate()-29);
      fromEl.value = (qsFrom || lsFrom || toISODate(from));
      toEl.value   = (qsTo   || lsTo   || toISODate(now));
      validate();
    }

    function validate(){
      const f = fromEl.value, t = toEl.value;
      const ok = f && t && new Date(f) <= new Date(t);
      btn.disabled = !ok;
      hint.textContent = ok ? '' : 'Velg gyldige datoer (start før slutt).';
    }

    fromEl.addEventListener('change', validate);
    toEl.addEventListener('change', validate);

    btn.addEventListener('click', () => {
      const f = fromEl.value, t = toEl.value;
      localStorage.setItem('bian.range.from', f);
      localStorage.setItem('bian.range.to', t);
      const qs = new URLSearchParams({ from:f, to:t });
      history.replaceState({}, '', location.pathname + '?' + qs.toString());
      btn.blur();
    });

    setDefaults();
  </script>
</body>
</html>
