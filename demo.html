<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: dark)">
  <title>Book demo — Scope</title>
  <meta name="description" content="Book en demo av Scope. Velg tidspunkt og få kalenderinvitasjon på e‑post." />
  <style>
    :root{
      --brand-600:#7d79f9;
      --brand-700:#6c63d9;
      --brand-gradient:linear-gradient(90deg,#7d79f9,#c864aa);
      --brand-outline:color-mix(in srgb,var(--brand-600),#fff 40%);
      --ink-900:#0b1220;--ink-800:#111827;--ink-700:#1f2937;--ink-600:#374151;--ink-500:#4b5563;
      --surface:#ffffff;--muted:#f9fafb;--border:#e5e7eb;
      --radius-lg:20px;--radius-sm:12px;
      --shadow:0 10px 28px rgba(2,6,23,.06);--ring:0 0 0 3px rgba(125,121,249,0.6);
      --track-light:#e5e7eb;--track-dark:#374151;
    }
    @media (prefers-color-scheme: dark){
      :root{color-scheme:light;--ink-900:#0b1220;--ink-800:#111827;--ink-700:#1f2937;--ink-600:#374151;--ink-500:#4b5563;--surface:#fff;--muted:#f5f7fb;--border:#e5e7eb}
      body{background:#fff;color:var(--ink-900)}
    }

    *,*::before,*::after{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:ui-sans-serif,Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink-900);background:#fff}

    .container{max-width:980px;margin:0 auto;padding:clamp(20px,4vw,40px)}

    header{display:flex;align-items:center;justify-content:space-between;padding:10px 0;font-family:"Poppins","Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;}
    a.brand{display:flex;align-items:center;text-decoration:none;font-weight:800;color:#756bff;font-size:clamp(1.45rem,3.2vw,1.95rem);letter-spacing:.045em;font-family:"Poppins","Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;transition:color .2s ease;text-transform:capitalize}
    a.brand:hover{color:#625aff}
    a.brand:visited{color:#756bff}
    body[data-theme="dark"] a.brand{color:#625aff}
    .nav-actions{display:flex;align-items:center;gap:12px;white-space:nowrap;font-family:"Poppins","Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;}
    #lang-toggle,.theme-switch{height:32px}
    .theme-switch{min-width:56px}

    .btn{appearance:none;border:1px solid var(--brand-outline);border-radius:999px;padding:12px 18px;font-weight:800;cursor:pointer;background:var(--surface);box-shadow:0 1px 2px rgba(2,6,23,.06);text-decoration:none;color:var(--ink-900);display:inline-flex;align-items:center}
    .btn:focus-visible{outline:none;box-shadow:var(--ring)}
    .btn.primary{background:var(--brand-gradient);border-color:transparent;color:#fff;box-shadow:0 6px 16px rgba(125,121,249,.25)}
    .btn.primary[disabled]{opacity:.7;cursor:not-allowed}

    .chip{border:1px solid var(--brand-outline);border-radius:999px;padding:0 16px;height:40px;font-weight:700;background:var(--surface);cursor:pointer;display:inline-flex;align-items:center;justify-content:center;min-width:60px;font-size:0.95rem;box-shadow:0 1px 2px rgba(2,6,23,.06);transition:background-color .20s ease,border-color .20s ease,color .20s ease;will-change:background-color,border-color,color;backface-visibility:hidden;transform:translateZ(0);font-family:"Poppins","Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;}
    .chip:focus-visible{outline:none;box-shadow:var(--ring)}
    .chip:hover{background:var(--muted)}
    body:not([data-theme="dark"]) .chip{color:#0b1220}
    body[data-theme="dark"] .chip{background:var(--surface);border-color:var(--brand-outline);color:#f3f5fa}

    .theme-switch{position:relative;display:inline-flex;width:56px;height:32px}
    .theme-switch input{opacity:0;width:0;height:0}
    .theme-switch .slider{position:relative;cursor:pointer;display:block;width:100%;height:100%;background:var(--track-light);transition:background-color .20s ease,border-color .20s ease,left .20s ease,transform .20s ease;border-radius:9999px;box-shadow:0 1px 2px rgba(0,0,0,.15);border:1px solid var(--brand-outline);padding:3px;backface-visibility:hidden;transform:translateZ(0)}
    .theme-switch input:focus-visible + .slider{box-shadow:var(--ring)}
    body[data-theme="dark"] .theme-switch .slider{background:var(--track-dark);box-shadow:0 1px 2px rgba(255,255,255,.3)}
    .theme-switch .thumb{position:absolute;top:50%;left:3px;width:24px;height:24px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color .20s ease,border-color .20s ease,left .20s ease,transform .20s ease;border:1px solid var(--brand-outline);box-shadow:0 2px 4px rgba(0,0,0,.2);transform:translateY(-50%) translateZ(0);backface-visibility:hidden}
    .theme-switch input:checked + .slider{background:var(--brand-600)}
    .theme-switch input:checked + .slider .thumb{left:calc(100% - 3px);transform:translate(-100%,-50%) translateZ(0)}
    .theme-switch .icon{width:16px;height:16px;stroke-width:2}
    .theme-switch .icon.sun{stroke:#FDB813;fill:none}
    .theme-switch .icon.moon{fill:#20354a;stroke:none;display:none}
    .theme-switch input:checked + .slider .icon.sun{display:none}
    .theme-switch input:checked + .slider .icon.moon{display:block}

    .theme-changing .chip,
    .theme-changing .theme-switch .slider,
    .theme-changing .theme-switch .thumb{transition-duration:.10s}

    body[data-theme="dark"]{--ink-900:#f9fafb;--ink-800:#e5e7eb;--ink-700:#d1d5db;--ink-600:#9ca3af;--ink-500:#6b7280;--surface:#111827;--muted:#1f2937;--border:#374151;background:#0b1220;color:var(--ink-900)}
    body[data-theme="dark"] header{background:rgba(17,24,39,.96)}
    body[data-theme="dark"] .btn{background:var(--surface);color:var(--ink-900);border-color:var(--brand-outline)}
    body[data-theme="dark"] .btn.primary{background:var(--brand-gradient);color:#fff;border-color:transparent}
    body[data-theme="dark"] form.card{background:var(--surface)}
    body[data-theme="dark"] input,body[data-theme="dark"] select{background:var(--muted);border-color:var(--border);color:var(--ink-900)}
    body[data-theme="dark"] .back{background:var(--surface);color:var(--ink-900);border-color:var(--brand-outline)}

    .eyebrow{display:inline-block;letter-spacing:.14em;color:var(--brand-600);font-weight:800;margin-top:8px}
    h1{font-size:clamp(32px,4.6vw,48px);margin:10px 0}
    .lead{color:var(--ink-800);max-width:70ch;margin:0 0 18px}

    form.card{margin-top:24px;border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:var(--shadow);padding:32px;background:var(--surface)}

    /* fields */
    label{display:block;margin:0 0 12px;font-weight:600}
    .hint{font-size:13px;color:var(--ink-600);margin-top:6px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    @media (max-width:760px){.row,.grid{grid-template-columns:1fr}}

    input,select{width:100%;padding:16px 18px;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface);outline:none;font-size:16px;color:var(--ink-900)}
    input::placeholder{color:var(--ink-500)}
    select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='20' height='20' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:40px}
    input:focus,select:focus{box-shadow:var(--ring);background:var(--surface);border-color:var(--brand-600)}
    input[aria-invalid="true"],select[aria-invalid="true"]{border-color:#dc2626;background:var(--surface)}

    .wizard .step{display:none;margin:40px 0}
    .progress{font-weight:700;margin-bottom:24px}
    .actions{display:flex;gap:12px;margin-top:32px;align-items:center;flex-wrap:wrap}
    .success{display:none;margin-top:14px;padding:14px;border-radius:14px;background:#f6f5ff;border:1px solid #d1c3f8}

    footer{margin-top:26px}

    /* back-cta chip */
    .back{display:inline-flex;align-items:center;gap:10px;border-radius:999px;border:1px solid var(--border);padding:10px 14px;background:var(--surface);text-decoration:none;color:inherit;box-shadow:var(--shadow)}
    .back svg{flex:none}
    .other-input{margin-top:12px;display:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <a class="brand" href="index.html">Scope</a>
      <div class="nav-actions">
        <button id="lang-toggle" class="chip" aria-label="Bytt språk">NO</button>
        <label class="theme-switch">
          <input type="checkbox" id="theme-toggle" aria-label="Tema">
          <span class="slider">
            <span class="thumb">
              <svg class="icon sun" viewBox="0 0 24 24" aria-hidden="true">
                <circle cx="12" cy="12" r="5"/>
                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <svg class="icon moon" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/>
              </svg>
            </span>
          </span>
        </label>
      </div>
    </header>

    <span class="eyebrow" data-i18n="eyebrow">KONTAKT</span>
    <h1 data-i18n="title">Book en demo</h1>
    <p class="lead" data-i18n="lead">Fyll inn info og velg tidspunkt. Du får kalenderinvitasjon på e‑post.</p>

    <form id="demo-form" class="card wizard" novalidate>
      <div id="progress" class="progress"></div>

      <div class="step">
        <label for="name" data-i18n="name_label">Navn</label>
        <input id="name" name="name" type="text" required placeholder="Ola Nordmann" autocomplete="name" data-i18n-attr="placeholder:name_ph" autofocus>
        <small class="hint err" id="err-name" hidden></small>
      </div>

      <div class="step">
        <label for="org" data-i18n="org_label">Org.nr</label>
        <input id="org" name="org" type="text" required pattern="^[0-9]{9}$" placeholder="999999999" inputmode="numeric" data-i18n-attr="placeholder:org_ph">
        <div class="hint" data-i18n="org_hint">9 siffer (Brønnøysund)</div>
        <small class="hint err" id="err-org" hidden></small>
      </div>

      <div class="step">
        <label for="email" data-i18n="email_label">E‑post</label>
        <input id="email" name="email" type="email" required placeholder="din@restaurant.no" autocomplete="email" data-i18n-attr="placeholder:email_ph">
        <small class="hint err" id="err-email" hidden></small>
      </div>

      <div class="step">
        <label for="phone" data-i18n="phone_label">Telefon (valgfritt)</label>
        <input id="phone" name="phone" type="tel" placeholder="+47 400 00 000" autocomplete="tel" data-i18n-attr="placeholder:phone_ph">
      </div>

      <div class="step">
        <label for="acc" data-i18n="acc_label">Regnskapssystem</label>
        <select id="acc" name="acc">
          <option value="Tripletex">Tripletex</option>
          <option value="PowerOffice">PowerOffice</option>
          <option value="Visma">Visma eAccounting</option>
          <option value="Other" data-i18n="other">Annet</option>
        </select>
        <input id="acc-other" name="acc_other" type="text" class="other-input" data-i18n-attr="placeholder:other_ph" placeholder="Specify">
        <small class="hint err" id="err-acc-other" hidden></small>
      </div>

      <div class="step">
        <label for="pos" data-i18n="pos_label">Kassesystem</label>
        <select id="pos" name="pos">
          <option value="Lightspeed">Lightspeed</option>
          <option value="Square">Square</option>
          <option value="Zettle">Zettle</option>
          <option value="Other" data-i18n="other">Annet</option>
        </select>
        <input id="pos-other" name="pos_other" type="text" class="other-input" data-i18n-attr="placeholder:other_ph" placeholder="Specify">
        <small class="hint err" id="err-pos-other" hidden></small>
      </div>

      <div class="step">
        <label for="time" data-i18n="time_label">Timeregistrering</label>
        <select id="time" name="time">
          <option value="Arbeidstid">Arbeidstid</option>
          <option value="Tamigo">Tamigo</option>
          <option value="Other" data-i18n="other">Annet</option>
        </select>
        <input id="time-other" name="time_other" type="text" class="other-input" data-i18n-attr="placeholder:other_ph" placeholder="Specify">
        <small class="hint err" id="err-time-other" hidden></small>
      </div>

      <div class="step">
        <label for="stock" data-i18n="stock_label">Varetelling</label>
        <select id="stock" name="stock">
          <option value="Excel">Excel</option>
          <option value="Poster">Poster</option>
          <option value="Other" data-i18n="other">Annet</option>
        </select>
        <input id="stock-other" name="stock_other" type="text" class="other-input" data-i18n-attr="placeholder:other_ph" placeholder="Specify">
        <small class="hint err" id="err-stock-other" hidden></small>
      </div>

      <div class="step" id="step-meetingMode">
        <fieldset id="meetingMode">
          <legend data-i18n="meeting.title">Møteform</legend>
          <p data-i18n="meeting.question">Ønsker du digitalt eller fysisk møte?</p>
          <div class="grid">
            <label><input type="radio" name="meetingMode" value="digital"><span data-i18n="meeting.digital">Digitalt</span></label>
            <label><input type="radio" name="meetingMode" value="physical"><span data-i18n="meeting.physical">Fysisk</span></label>
          </div>
          <small class="hint err" id="err-meetingMode" aria-live="polite" hidden></small>
        </fieldset>
      </div>

      <div class="step" id="step-meetingWhen">
        <fieldset id="meetingWhen">
          <legend data-i18n="meetingWhen.title">Dato og tidspunkt</legend>
          <div class="grid">
            <div>
              <label for="meetingDate" data-i18n="meetingWhen.dateLabel">Dato</label>
              <input id="meetingDate" name="meetingDate" type="date" required min="">
              <small class="hint err" id="err-meetingDate" aria-live="polite" hidden></small>
            </div>
            <div>
              <label for="meetingTime" data-i18n="meetingWhen.timeLabel">Tid</label>
              <input id="meetingTime" name="meetingTime" type="time" required step="900" min="09:00" max="16:00">
              <div class="hint" data-i18n="time_hint">Kontortid 09:00–16:00 CET</div>
              <small class="hint err" id="err-meetingTime" aria-live="polite" hidden></small>
            </div>
          </div>
          <div id="address-wrap" style="margin-top:18px;display:none">
            <label for="meetingAddress" data-i18n="meetingWhen.addressOptional">Adresse / sted (valgfritt)</label>
            <input id="meetingAddress" name="meetingAddress" type="text">
          </div>
        </fieldset>
      </div>

      <div class="actions">
        <button type="button" class="btn" id="back" data-i18n="back">Tilbake</button>
        <button type="button" class="btn primary" id="next" data-i18n="next">Neste</button>
        <button class="btn primary" id="submit" type="submit" data-i18n="submit">Send forespørsel</button>
        <span id="status" class="hint" role="status" aria-live="polite"></span>
      </div>

      <div id="ok" class="success" data-i18n="success">
        Takk! Invitasjon sendt. Vi har også generert en .ics om du vil legge til manuelt.
        <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
          <a id="gcal" class="btn" href="#" target="_blank" rel="noopener" style="display:none" data-i18n="add_gcal">Legg til i Google Kalender</a>
          <a id="ics" class="btn" href="#" download="Scope-demo.ics" style="display:none" data-i18n="download_ics">Last ned .ics</a>
        </div>
      </div>
    </form>

    <footer>
      <a href="index.html" class="back" data-i18n="back_home">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 8 8 12 12 16"></polyline>
          <line x1="16" y1="12" x2="8" y2="12"></line>
        </svg>
        ← Tilbake til siden
      </a>
    </footer>
  </div>

  <script>
    // Helpers
    const $=(s,c=document)=>c.querySelector(s), $$=(s,c=document)=>Array.from(c.querySelectorAll(s));

    function applyTheme(theme){
      document.body.setAttribute('data-theme', theme);
      // stop changing meta[name="color-scheme"] here to avoid full repaint flicker
      const toggle=document.querySelector('#theme-toggle');
      if(toggle) toggle.checked = (theme === 'dark');
      // brief easing class to normalize transitions (prevents blink)
      document.body.classList.add('theme-changing');
      requestAnimationFrame(()=> setTimeout(()=> {
        document.body.classList.remove('theme-changing');
      }, 160));
    }
    const savedTheme=localStorage.getItem('scope.theme')||'light';
    applyTheme(savedTheme);
    $('#theme-toggle')?.addEventListener('change',e=>{
      const t=e.target.checked?'dark':'light';
      localStorage.setItem('scope.theme',t);
      applyTheme(t);
    });

    // i18n
    const dict={
      no:{eyebrow:"KONTAKT",title:"Book en demo",lead:"Fyll inn info og velg tidspunkt. Du får kalenderinvitasjon på e‑post.",
          name_label:"Navn",name_ph:"Ola Nordmann",
          org_label:"Org.nr",org_ph:"999999999",org_hint:"9 siffer (Brønnøysund)",
          email_label:"E‑post",email_ph:"din@restaurant.no",
          phone_label:"Telefon (valgfritt)",phone_ph:"+47 400 00 000",
          acc_label:"Regnskapssystem",pos_label:"Kassesystem",time_label:"Timeregistrering",stock_label:"Varetelling",
          other:"Annet",other_ph:"Vennligst spesifiser",
          time_hint:"Kontortid 09:00–16:00 CET",
          "meeting.title":"Møteform","meeting.question":"Ønsker du digitalt eller fysisk møte?","meeting.digital":"Digitalt","meeting.physical":"Fysisk",
          "meetingWhen.title":"Dato og tidspunkt","meetingWhen.dateLabel":"Dato","meetingWhen.timeLabel":"Tidspunkt","meetingWhen.addressOptional":"Adresse / sted (valgfritt)","meetingWhen.errors.required":"Oppgi dato og tidspunkt","meetingWhen.errors.window":"Velg et tidspunkt mellom 09:00 og 16:00",
          submit:"Send forespørsel",add_gcal:"Legg til i Google Kalender",download_ics:"Last ned .ics",
          success:"Takk! Invitasjon sendt. Vi har også generert en .ics om du vil legge til manuelt.",
          back_home:"← Tilbake til siden",invalid:"Vennligst fyll ut alle felter korrekt.",
          sending:"Sender …",sent:"Invitasjon sendt!",btn_lang:"Bytt til engelsk",
          next:"Neste",back:"Tilbake",step:"Steg",of:"av",
          err_name:"Skriv inn navn", err_org:"Ugyldig org.nr (9 siffer)", err_email:"Ugyldig e‑post", err_date:"Velg en dato", err_time:"Velg et tidspunkt 09–16", err_other:"Vennligst spesifiser"},
      en:{eyebrow:"CONTACT",title:"Book a demo",lead:"Fill in your details and pick a time. You’ll receive a calendar invitation by email.",
          name_label:"Name",name_ph:"Jane Doe",
          org_label:"Org. number",org_ph:"999999999",org_hint:"9 digits (Brønnøysund)",
          email_label:"Email",email_ph:"you@restaurant.com",
          phone_label:"Phone (optional)",phone_ph:"+47 400 00 000",
          acc_label:"Accounting system",pos_label:"POS / Cash register",time_label:"Time tracking",stock_label:"Stock counting",
          other:"Other",other_ph:"Please specify",
          time_hint:"Office hours 09:00–16:00 CET",
          "meeting.title":"Meeting type","meeting.question":"Do you prefer a digital or an in-person meeting?","meeting.digital":"Digital","meeting.physical":"In-person",
          "meetingWhen.title":"Date & time","meetingWhen.dateLabel":"Date","meetingWhen.timeLabel":"Time","meetingWhen.addressOptional":"Address / venue (optional)","meetingWhen.errors.required":"Please pick a date and time","meetingWhen.errors.window":"Please pick a time between 09:00 and 16:00",
          submit:"Send request",add_gcal:"Add to Google Calendar",download_ics:"Download .ics",
          success:"Thanks! Invitation sent. We also generated an .ics in case you want to add it manually.",
          back_home:"← Back to site",invalid:"Please fill in all fields correctly.",
          sending:"Sending …",sent:"Invitation sent!",btn_lang:"Switch to Norwegian",
          next:"Next",back:"Back",step:"Step",of:"of",
          err_name:"Please enter your name", err_org:"Invalid org. number (9 digits)", err_email:"Invalid email", err_date:"Pick a date", err_time:"Pick a time 09–16", err_other:"Please specify"}
    };
    const langBtn=$('#lang-toggle');
    const initial=localStorage.getItem('scope.lang') || ((navigator.language||'').toLowerCase().startsWith('no')?'no':'en');
    function t(k){return dict[(document.documentElement.lang)||'no'][k]||k}
    function applyLang(l){
      document.documentElement.lang=l;langBtn.textContent=l.toUpperCase();
      $$('[data-i18n]').forEach(el=>el.textContent=t(el.getAttribute('data-i18n')));
      $$('[data-i18n-attr]').forEach(el=>{el.getAttribute('data-i18n-attr').split(',').forEach(p=>{const [attr,key]=p.split(':').map(s=>s.trim());el.setAttribute(attr,t(key))})});
      $('#status').textContent='';
      updateProgress();
    }

    const steps=$$('.step');
    let current=0;
    const backBtn=$('#back');
    const nextBtn=$('#next');
    const submitBtn=$('#submit');

    function updateProgress(){
      $('#progress').textContent=`${t('step')} ${current+1} ${t('of')} ${steps.length}`;
    }
    function showStep(i){
      steps.forEach((s,idx)=>{ s.style.display=idx===i?'block':'none'; });
      backBtn.style.display=i>0?'inline-flex':'none';
      nextBtn.style.display=i<steps.length-1?'inline-flex':'none';
      submitBtn.style.display=i===steps.length-1?'inline-flex':'none';
      updateProgress();
    }
    
function validateStep(i){
      switch(i){
        case 0:{const v=$('#name').value.trim(); if(!v){ setErr('name',t('err_name')); return false;} setErr('name'); return true;}
        case 1:{const v=$('#org').value.trim(); if(!/^\d{9}$/.test(v)){ setErr('org',t('err_org')); return false;} setErr('org'); return true;}
        case 2:{const v=$('#email').value.trim(); if(!/^\S+@\S+\.\S+$/.test(v)){ setErr('email',t('err_email')); return false;} setErr('email'); return true;}
        case 4:{if($('#acc').value==='Other'){const v=$('#acc-other').value.trim(); if(!v){ setErr('acc-other',t('err_other')); return false;} setErr('acc-other');} return true;}
        case 5:{if($('#pos').value==='Other'){const v=$('#pos-other').value.trim(); if(!v){ setErr('pos-other',t('err_other')); return false;} setErr('pos-other');} return true;}
        case 6:{if($('#time').value==='Other'){const v=$('#time-other').value.trim(); if(!v){ setErr('time-other',t('err_other')); return false;} setErr('time-other');} return true;}
        case 7:{if($('#stock').value==='Other'){const v=$('#stock-other').value.trim(); if(!v){ setErr('stock-other',t('err_other')); return false;} setErr('stock-other');} return true;}
        case 8:{const v=$$('input[name="meetingMode"]:checked')[0]?.value; if(!v){ setErr('meetingMode',t('meetingWhen.errors.required')); return false;} setErr('meetingMode'); return true;}
        case 9:{const d=$('#meetingDate').value; const tm=$('#meetingTime').value; let ok=true; if(!d){ setErr('meetingDate',t('meetingWhen.errors.required')); ok=false;} else setErr('meetingDate'); if(!tm){ setErr('meetingTime',t('meetingWhen.errors.required')); ok=false;} else if(tm<'09:00' || tm>'16:00'){ setErr('meetingTime',t('meetingWhen.errors.window')); ok=false;} else setErr('meetingTime'); return ok;}
        default:return true;
      }
    }
    backBtn.addEventListener('click',()=>{ if(current>0){ current--; showStep(current);} });
    nextBtn.addEventListener('click',()=>{ if(validateStep(current)){ current++; showStep(current);} });

    showStep(current);
    applyLang(initial);
    langBtn.addEventListener('click',()=>{const next=document.documentElement.lang==='en'?'no':'en';localStorage.setItem('scope.lang',next);applyLang(next);});

    // Prefill from query params (nice UX)
    (function(){const u=new URL(location.href); const qp=(k)=>u.searchParams.get(k)||''; if(qp('email')) $('#email').value=qp('email'); if(qp('name')) $('#name').value=qp('name');})();

    // min date = today + default to today
    const today=new Date();today.setHours(0,0,0,0);const iso=today.toISOString().slice(0,10);$('#meetingDate').min=iso; if(!$('#meetingDate').value) $('#meetingDate').value=iso;

    // Inline validation helpers
    const setErr=(id,msg)=>{const el=$('#'+id); const err=$('#err-'+id); if(!msg){ el?.setAttribute('aria-invalid','false'); err?.setAttribute('hidden',''); err&&(err.textContent=''); } else { el?.setAttribute('aria-invalid','true'); if(err){ err.textContent=msg; err.removeAttribute('hidden'); } }};

    function toggleOther(id){
      const sel=$('#'+id);
      const inp=$('#'+id+'-other');
      if(sel.value==='Other'){
        inp.style.display='block';
        inp.required=true;
      } else {
        inp.style.display='none';
        inp.required=false;
        inp.value='';
        setErr(id+'-other');
      }
    }
    ['acc','pos','time','stock'].forEach(id=>{
      $('#'+id).addEventListener('change',()=>toggleOther(id));
      toggleOther(id);
    });

    function toggleAddress(){
      const mode=$$('input[name="meetingMode"]:checked')[0]?.value;
      const wrap=$('#address-wrap');
      if(mode==='physical'){
        wrap.style.display='block';
      } else {
        wrap.style.display='none';
        $('#meetingAddress').value='';
      }
    }
    $$('input[name="meetingMode"]').forEach(r=>r.addEventListener('change',toggleAddress));
    toggleAddress();

    function validate(){
      const l=document.documentElement.lang||'no';
      const name=$('#name').value.trim();
      const org=$('#org').value.trim();
      const email=$('#email').value.trim();
      const meetingMode=$$('input[name="meetingMode"]:checked')[0]?.value;
      const meetingDate=$('#meetingDate').value; const meetingTime=$('#meetingTime').value;
      const meetingAddress=$('#meetingAddress').value.trim();
      const accSel=$('#acc').value; const accOther=$('#acc-other').value.trim();
      const posSel=$('#pos').value; const posOther=$('#pos-other').value.trim();
      const timeSel=$('#time').value; const timeOther=$('#time-other').value.trim();
      const stockSel=$('#stock').value; const stockOther=$('#stock-other').value.trim();
      let ok=true;
      if(!name){ setErr('name',t('err_name')); ok=false; } else setErr('name');
      if(!/^\d{9}$/.test(org)){ setErr('org',t('err_org')); ok=false; } else setErr('org');
      if(!/^\S+@\S+\.\S+$/.test(email)){ setErr('email',t('err_email')); ok=false; } else setErr('email');
      if(accSel==='Other' && !accOther){ setErr('acc-other',t('err_other')); ok=false; } else setErr('acc-other');
      if(posSel==='Other' && !posOther){ setErr('pos-other',t('err_other')); ok=false; } else setErr('pos-other');
      if(timeSel==='Other' && !timeOther){ setErr('time-other',t('err_other')); ok=false; } else setErr('time-other');
      if(stockSel==='Other' && !stockOther){ setErr('stock-other',t('err_other')); ok=false; } else setErr('stock-other');
      if(!meetingMode){ setErr('meetingMode',t('meetingWhen.errors.required')); ok=false;} else setErr('meetingMode');
      if(!meetingDate){ setErr('meetingDate',t('meetingWhen.errors.required')); ok=false;} else setErr('meetingDate');
      if(!meetingTime){ setErr('meetingTime',t('meetingWhen.errors.required')); ok=false; } else if(meetingTime<'09:00' || meetingTime>'16:00'){ setErr('meetingTime',t('meetingWhen.errors.window')); ok=false; } else setErr('meetingTime');
      return ok;
    }

    // ICS helpers
    function pad(n){return String(n).padStart(2,'0')}
    function toUTCStamp(d){return d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+'T'+pad(d.getUTCHours())+pad(d.getUTCMinutes())+pad(d.getUTCSeconds())+'Z'}
    function makeICS({start,end,summary,description,organizer,attendee,email,location='Online'}){
      const uid='scope-'+Math.random().toString(36).slice(2)+'@scope';
      return [
        'BEGIN:VCALENDAR','PRODID:-//Scope//Demo//NO','VERSION:2.0','CALSCALE:GREGORIAN','METHOD:REQUEST',
        'BEGIN:VEVENT',
        'DTSTAMP:'+toUTCStamp(new Date()),
        'DTSTART:'+toUTCStamp(start),
        'DTEND:'+toUTCStamp(end),
        'SUMMARY:'+summary,
        'DESCRIPTION:'+description.replace(/\n/g,'\\n'),
        'LOCATION:'+location,
        'ORGANIZER;CN='+organizer+':mailto:demo@scope.app',
        'ATTENDEE;CN='+attendee+';ROLE=REQ-PARTICIPANT;RSVP=TRUE:mailto:'+email,
        'UID:'+uid,'SEQUENCE:0','STATUS:CONFIRMED',
        'END:VEVENT','END:VCALENDAR'
      ].join('\r\n');
    }
    function blobDownload(name,content,type='text/calendar'){
      const a=$('#ics');a.href=URL.createObjectURL(new Blob([content],{type}));a.download=name;a.style.display='inline-flex';
    }
    function googleCalendarUrl({start,end,title,details,location}){
      const fmt=(d)=>d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
      const p=new URLSearchParams({action:'TEMPLATE',text:title,dates:`${fmt(start)}/${fmt(end)}`,details,location});
      return 'https://calendar.google.com/calendar/render?'+p.toString();
    }

    // Submit
    $('#demo-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!validate()){ $('#status').textContent=t('invalid'); return; }
      const l=document.documentElement.lang||'no';
      const data={
        name:$('#name').value.trim(),
        org:$('#org').value.trim(),
        email:$('#email').value.trim(),
        phone:$('#phone').value.trim(),
        acc:$('#acc').value==='Other'?$('#acc-other').value.trim():$('#acc').value,
        pos:$('#pos').value==='Other'?$('#pos-other').value.trim():$('#pos').value,
        time:$('#time').value==='Other'?$('#time-other').value.trim():$('#time').value,
        stock:$('#stock').value==='Other'?$('#stock-other').value.trim():$('#stock').value,
        meetingMode:$$('input[name="meetingMode"]:checked')[0]?.value,
        meetingDate:$('#meetingDate').value,
        meetingTime:$('#meetingTime').value
      };
      if(data.meetingMode==='physical'){
        const addr=$('#meetingAddress').value.trim();
        if(addr) data.meetingAddress=addr;
      }
      const meetingDateTime=new Date(`${data.meetingDate}T${data.meetingTime}:00`);
      const start=meetingDateTime;
      const end=new Date(start.getTime()+45*60*1000);
      data.meetingDateTime=meetingDateTime.toISOString();

      const title=l==='en'?'Scope demo call':'Scope demomøte';
      const desc=[
        (l==='en'?'Thanks for booking a demo!':'Takk for at du booket en demo!'),
        '', (l==='en'?'Details:':'Detaljer:'),
        `Org.nr: ${data.org}`,
        `Email: ${data.email}`,
        `Phone: ${data.phone||'-'}`,
        `Meeting type: ${data.meetingMode==='physical'?t('meeting.physical'):t('meeting.digital')}`,
        data.meetingAddress?`Address: ${data.meetingAddress}`:'',
        `Accounting: ${data.acc}`,
        `POS: ${data.pos}`,
        `Time: ${data.time}`,
        `Stock: ${data.stock}`
      ].filter(Boolean).join('\n');

      submitBtn.disabled=true; submitBtn.textContent=t('sending');

      const location=data.meetingMode==='physical'?(data.meetingAddress||(l==='en'?'In-person':'Fysisk')):'Online';
      const ics=makeICS({start,end,summary:title,description:desc,organizer:'Scope',attendee:data.name,email:data.email,location});
      blobDownload('Scope-demo.ics',ics);
      const gcal=googleCalendarUrl({start,end,title,details:desc,location});
      const gcalLink=$('#gcal'); gcalLink.href=gcal; gcalLink.style.display='inline-flex';

      $('#status').textContent=t('sending');

      try{
        const res=await fetch('/.netlify/functions/book-demo',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({...data,start:start.toISOString(),end:end.toISOString(),lang:l,ics})});
        $('#ok').style.display='block';
        $('#status').textContent=t('sent');
      }catch(err){
        $('#ok').style.display='block';
        $('#status').textContent=t('sent');
      } finally {
        submitBtn.disabled=false; submitBtn.textContent=t('submit');
        $('#ok').scrollIntoView({behavior:'smooth',block:'center'});
      }
    });
  </script>
</body>
</html>
