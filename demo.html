<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Book demo — Scope</title>
  <meta name="description" content="Book en demo av Scope. Velg tidspunkt og få kalenderinvitasjon på e‑post." />
  <style>
    :root{
      --brand:#ff8a00;          /* Scope orange */
      --brand-700:#e67300;
      --ink:#0b1220;            /* text */
      --muted:#f5f7fb;          /* page subtle */
      --muted-2:#f9fafb;        /* input bg */
      --border:#e5e7eb;
      --shadow:0 10px 28px rgba(2,6,23,.06);
      --ring:0 0 0 4px rgba(255,138,0,.18);
      --radius-lg:20px;
      --radius-sm:12px;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:ui-sans-serif,Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:#fff}

    .container{max-width:980px;margin:0 auto;padding:clamp(20px,4vw,40px)}

    header{display:flex;align-items:center;justify-content:space-between;padding:10px 0}
    a.brand{display:flex;gap:.6rem;align-items:center;text-decoration:none;color:var(--ink);font-weight:800}
    .logo{width:40px;height:40px;border-radius:14px;background:#fff;border:2px solid var(--brand);display:grid;place-items:center;color:var(--brand);box-shadow:var(--shadow)}
    #lang{border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-weight:700;background:#fff;cursor:pointer}

    .eyebrow{display:inline-block;letter-spacing:.14em;color:var(--brand);font-weight:800;margin-top:8px}
    h1{font-size:clamp(32px,4.6vw,48px);margin:10px 0}
    .lead{color:#111827;max-width:70ch;margin:0 0 18px}

    form.card{margin-top:18px;border:1px solid var(--border);border-radius:var(--radius-lg);box-shadow:var(--shadow);padding:18px;background:#fff}

    /* fields */
    label{display:block;margin:12px 0 8px;font-weight:700}
    .hint{font-size:13px;color:#6b7280;margin-top:6px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:18px}
    @media (max-width:760px){.row,.grid{grid-template-columns:1fr}}

    input,select{width:100%;padding:14px 16px;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--muted-2);outline:none;font-size:16px}
    input::placeholder{color:#9ca3af}
    select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='20' height='20' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:40px}
    input:focus,select:focus{box-shadow:var(--ring);background:#fff;border-color:#f0a24a}
    input[aria-invalid="true"],select[aria-invalid="true"]{border-color:#dc2626;background:#fff}

    .actions{display:flex;gap:12px;margin-top:16px;align-items:center;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--border);border-radius:999px;padding:12px 18px;font-weight:800;cursor:pointer;background:#fff;box-shadow:0 1px 2px rgba(2,6,23,.06);text-decoration:none;color:var(--ink)}
    .btn.primary{background:var(--brand);border-color:transparent;color:#fff;box-shadow:0 6px 16px rgba(255,138,0,.25)}
    .btn.primary[disabled]{opacity:.7;cursor:not-allowed}

    .success{display:none;margin-top:14px;padding:14px;border-radius:14px;background:#fff8ef;border:1px solid #ffd7b0}

    footer{margin-top:26px}

    /* back-cta chip */
    .back{display:inline-flex;align-items:center;gap:10px;border-radius:999px;border:1px solid var(--border);padding:10px 14px;background:#fff;text-decoration:none;color:inherit;box-shadow:var(--shadow)}
    .back svg{flex:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <a class="brand" href="index.html">
        <div class="logo" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 40 40" aria-hidden="true" focusable="false">
            <circle cx="20" cy="20" r="15" fill="none" stroke="currentColor" stroke-width="3"/>
            <circle cx="20" cy="20" r="9" fill="none" stroke="currentColor" stroke-width="3"/>
            <circle cx="20" cy="20" r="3" fill="currentColor"/>
          </svg>
        </div>
        <span>Scope</span>
      </a>
      <button id="lang" class="chip" aria-label="Bytt språk">NO</button>
    </header>

    <span class="eyebrow" data-i18n="eyebrow">KONTAKT</span>
    <h1 data-i18n="title">Book en demo</h1>
    <p class="lead" data-i18n="lead">Fyll inn info og velg tidspunkt. Du får kalenderinvitasjon på e‑post.</p>

    <form id="demo-form" class="card" novalidate>
      <div class="row">
        <div>
          <label for="name" data-i18n="name_label">Navn</label>
          <input id="name" name="name" type="text" required placeholder="Ola Nordmann" autocomplete="name" data-i18n-attr="placeholder:name_ph" autofocus>
          <small class="hint err" id="err-name" hidden></small>
        </div>
        <div>
          <label for="org" data-i18n="org_label">Org.nr</label>
          <input id="org" name="org" type="text" required pattern="^[0-9]{9}$" placeholder="999999999" inputmode="numeric" data-i18n-attr="placeholder:org_ph">
          <div class="hint" data-i18n="org_hint">9 siffer (Brønnøysund)</div>
          <small class="hint err" id="err-org" hidden></small>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="email" data-i18n="email_label">E‑post</label>
          <input id="email" name="email" type="email" required placeholder="din@restaurant.no" autocomplete="email" data-i18n-attr="placeholder:email_ph">
          <small class="hint err" id="err-email" hidden></small>
        </div>
        <div>
          <label for="phone" data-i18n="phone_label">Telefon (valgfritt)</label>
          <input id="phone" name="phone" type="tel" placeholder="+47 400 00 000" autocomplete="tel" data-i18n-attr="placeholder:phone_ph">
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="acc" data-i18n="acc_label">Regnskapssystem</label>
          <select id="acc" name="acc">
            <option value="Tripletex">Tripletex</option>
            <option value="PowerOffice">PowerOffice</option>
            <option value="Visma">Visma eAccounting</option>
            <option value="Other" data-i18n="other">Annet</option>
          </select>
        </div>
        <div>
          <label for="pos" data-i18n="pos_label">Kassesystem</label>
          <select id="pos" name="pos">
            <option value="Lightspeed">Lightspeed</option>
            <option value="Square">Square</option>
            <option value="Zettle">Zettle</option>
            <option value="Other" data-i18n="other">Annet</option>
          </select>
        </div>
        <div>
          <label for="time" data-i18n="time_label">Timeregistrering</label>
          <select id="time" name="time">
            <option value="Arbeidstid">Arbeidstid</option>
            <option value="Tamigo">Tamigo</option>
            <option value="Other" data-i18n="other">Annet</option>
          </select>
        </div>
        <div>
          <label for="stock" data-i18n="stock_label">Varetelling</label>
          <select id="stock" name="stock">
            <option value="Excel">Excel</option>
            <option value="Poster">Poster</option>
            <option value="Other" data-i18n="other">Annet</option>
          </select>
        </div>
      </div>

      <div class="grid">
        <div>
          <label for="date" data-i18n="date_label">Foretrukket dato</label>
          <input id="date" name="date" type="date" required min="">
          <small class="hint err" id="err-date" hidden></small>
        </div>
        <div>
          <label for="timepick" data-i18n="timepick_label">Foretrukket tidspunkt</label>
          <input id="timepick" name="timepick" type="time" required step="900" min="09:00" max="16:00" value="10:00">
          <div class="hint" data-i18n="time_hint">Kontortid 09:00–16:00 CET</div>
          <small class="hint err" id="err-time" hidden></small>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="submit" type="submit" data-i18n="submit">Send forespørsel</button>
        <span id="status" class="hint" role="status" aria-live="polite"></span>
      </div>

      <div id="ok" class="success" data-i18n="success">
        Takk! Invitasjon sendt. Vi har også generert en .ics om du vil legge til manuelt.
        <div style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap">
          <a id="gcal" class="btn" href="#" target="_blank" rel="noopener" style="display:none" data-i18n="add_gcal">Legg til i Google Kalender</a>
          <a id="ics" class="btn" href="#" download="Scope-demo.ics" style="display:none" data-i18n="download_ics">Last ned .ics</a>
        </div>
      </div>
    </form>

    <footer>
      <a href="index.html" class="back" data-i18n="back_home">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 8 8 12 12 16"></polyline>
          <line x1="16" y1="12" x2="8" y2="12"></line>
        </svg>
        ← Tilbake til siden
      </a>
    </footer>
  </div>

  <script>
    // Helpers
    const $=(s,c=document)=>c.querySelector(s), $$=(s,c=document)=>Array.from(c.querySelectorAll(s));

    // i18n
    const dict={
      no:{eyebrow:"KONTAKT",title:"Book en demo",lead:"Fyll inn info og velg tidspunkt. Du får kalenderinvitasjon på e‑post.",
          name_label:"Navn",name_ph:"Ola Nordmann",
          org_label:"Org.nr",org_ph:"999999999",org_hint:"9 siffer (Brønnøysund)",
          email_label:"E‑post",email_ph:"din@restaurant.no",
          phone_label:"Telefon (valgfritt)",phone_ph:"+47 400 00 000",
          acc_label:"Regnskapssystem",pos_label:"Kassesystem",time_label:"Timeregistrering",stock_label:"Varetelling",
          other:"Annet",date_label:"Foretrukket dato",timepick_label:"Foretrukket tidspunkt",
          time_hint:"Kontortid 09:00–16:00 CET",
          submit:"Send forespørsel",add_gcal:"Legg til i Google Kalender",download_ics:"Last ned .ics",
          success:"Takk! Invitasjon sendt. Vi har også generert en .ics om du vil legge til manuelt.",
          back_home:"← Tilbake til siden",invalid:"Vennligst fyll ut alle felter korrekt.",
          sending:"Sender …",sent:"Invitasjon sendt!",btn_lang:"Bytt til engelsk",
          err_name:"Skriv inn navn", err_org:"Ugyldig org.nr (9 siffer)", err_email:"Ugyldig e‑post", err_date:"Velg en dato", err_time:"Velg et tidspunkt 09–16"},
      en:{eyebrow:"CONTACT",title:"Book a demo",lead:"Fill in your details and pick a time. You’ll receive a calendar invitation by email.",
          name_label:"Name",name_ph:"Jane Doe",
          org_label:"Org. number",org_ph:"999999999",org_hint:"9 digits (Brønnøysund)",
          email_label:"Email",email_ph:"you@restaurant.com",
          phone_label:"Phone (optional)",phone_ph:"+47 400 00 000",
          acc_label:"Accounting system",pos_label:"POS / Cash register",time_label:"Time tracking",stock_label:"Stock counting",
          other:"Other",date_label:"Preferred date",timepick_label:"Preferred time",
          time_hint:"Office hours 09:00–16:00 CET",
          submit:"Send request",add_gcal:"Add to Google Calendar",download_ics:"Download .ics",
          success:"Thanks! Invitation sent. We also generated an .ics in case you want to add it manually.",
          back_home:"← Back to site",invalid:"Please fill in all fields correctly.",
          sending:"Sending …",sent:"Invitation sent!",btn_lang:"Switch to Norwegian",
          err_name:"Please enter your name", err_org:"Invalid org. number (9 digits)", err_email:"Invalid email", err_date:"Pick a date", err_time:"Pick a time 09–16"}
    };
    const langBtn=$('#lang');
    const initial=localStorage.getItem('scope.lang') || ((navigator.language||'').toLowerCase().startsWith('no')?'no':'en');
    function t(k){return dict[(document.documentElement.lang)||'no'][k]||k}
    function applyLang(l){
      document.documentElement.lang=l;langBtn.textContent=l.toUpperCase();
      $$('[data-i18n]').forEach(el=>el.textContent=t(el.getAttribute('data-i18n')));
      $$('[data-i18n-attr]').forEach(el=>{el.getAttribute('data-i18n-attr').split(',').forEach(p=>{const [attr,key]=p.split(':').map(s=>s.trim());el.setAttribute(attr,t(key))})});
      $('#status').textContent='';
    }
    applyLang(initial);
    langBtn.addEventListener('click',()=>{const next=document.documentElement.lang==='en'?'no':'en';localStorage.setItem('scope.lang',next);applyLang(next)});

    // Prefill from query params (nice UX)
    (function(){const u=new URL(location.href); const qp=(k)=>u.searchParams.get(k)||''; if(qp('email')) $('#email').value=qp('email'); if(qp('name')) $('#name').value=qp('name');})();

    // min date = today + default to today
    const today=new Date();today.setHours(0,0,0,0);const iso=today.toISOString().slice(0,10);$('#date').min=iso; if(!$('#date').value) $('#date').value=iso;

    // Inline validation helpers
    const setErr=(id,msg)=>{const el=$('#'+id); const err=$('#err-'+id); if(!msg){ el?.setAttribute('aria-invalid','false'); err?.setAttribute('hidden',''); err&&(err.textContent=''); } else { el?.setAttribute('aria-invalid','true'); if(err){ err.textContent=msg; err.removeAttribute('hidden'); } }};

    function validate(){
      const l=document.documentElement.lang||'no';
      const name=$('#name').value.trim();
      const org=$('#org').value.trim();
      const email=$('#email').value.trim();
      const date=$('#date').value; const time=$('#timepick').value;
      let ok=true;
      if(!name){ setErr('name',t('err_name')); ok=false; } else setErr('name');
      if(!/^\d{9}$/.test(org)){ setErr('org',t('err_org')); ok=false; } else setErr('org');
      if(!/^\S+@\S+\.\S+$/.test(email)){ setErr('email',t('err_email')); ok=false; } else setErr('email');
      if(!date){ setErr('date',t('err_date')); ok=false; } else setErr('date');
      if(!time || time<'09:00' || time>'16:00'){ setErr('time',t('err_time')); ok=false; } else setErr('time');
      return ok;
    }

    // ICS helpers
    function pad(n){return String(n).padStart(2,'0')}
    function toUTCStamp(d){return d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+'T'+pad(d.getUTCHours())+pad(d.getUTCMinutes())+pad(d.getUTCSeconds())+'Z'}
    function makeICS({start,end,summary,description,organizer,attendee,email}){
      const uid='scope-'+Math.random().toString(36).slice(2)+'@scope';
      return [
        'BEGIN:VCALENDAR','PRODID:-//Scope//Demo//NO','VERSION:2.0','CALSCALE:GREGORIAN','METHOD:REQUEST',
        'BEGIN:VEVENT',
        'DTSTAMP:'+toUTCStamp(new Date()),
        'DTSTART:'+toUTCStamp(start),
        'DTEND:'+toUTCStamp(end),
        'SUMMARY:'+summary,
        'DESCRIPTION:'+description.replace(/\n/g,'\\n'),
        'LOCATION:Online',
        'ORGANIZER;CN='+organizer+':mailto:demo@scope.app',
        'ATTENDEE;CN='+attendee+';ROLE=REQ-PARTICIPANT;RSVP=TRUE:mailto:'+email,
        'UID:'+uid,'SEQUENCE:0','STATUS:CONFIRMED',
        'END:VEVENT','END:VCALENDAR'
      ].join('\r\n');
    }
    function blobDownload(name,content,type='text/calendar'){
      const a=$('#ics');a.href=URL.createObjectURL(new Blob([content],{type}));a.download=name;a.style.display='inline-flex';
    }
    function googleCalendarUrl({start,end,title,details}){
      const fmt=(d)=>d.toISOString().replace(/[-:]/g,'').split('.')[0]+'Z';
      const p=new URLSearchParams({action:'TEMPLATE',text:title,dates:`${fmt(start)}/${fmt(end)}`,details,location:'Online'});
      return 'https://calendar.google.com/calendar/render?'+p.toString();
    }

    // Submit
    $('#demo-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!validate()){ $('#status').textContent=t('invalid'); return; }
      const l=document.documentElement.lang||'no';
      const data={
        name:$('#name').value.trim(),
        org:$('#org').value.trim(),
        email:$('#email').value.trim(),
        phone:$('#phone').value.trim(),
        acc:$('#acc').value, pos:$('#pos').value, time:$('#time').value, stock:$('#stock').value,
        date:$('#date').value, clock:$('#timepick').value
      };

      const [hh,mm]=data.clock.split(':').map(Number);
      const [yyyy,MM,dd]=data.date.split('-').map(Number);
      const start=new Date(yyyy,MM-1,dd,hh,mm,0);
      const end=new Date(start.getTime()+45*60*1000);

      const title=l==='en'?'Scope demo call':'Scope demomøte';
      const desc=[
        (l==='en'?'Thanks for booking a demo!':'Takk for at du booket en demo!'),
        '', (l==='en'?'Details:':'Detaljer:'),
        `Org.nr: ${data.org}`,
        `Email: ${data.email}`,
        `Phone: ${data.phone||'-'}`,
        `Accounting: ${data.acc}`,
        `POS: ${data.pos}`,
        `Time: ${data.time}`,
        `Stock: ${data.stock}`
      ].join('\n');

      const submitBtn=$('#submit'); submitBtn.disabled=true; submitBtn.textContent=t('sending');

      const ics=makeICS({start,end,summary:title,description:desc,organizer:'Scope',attendee:data.name,email:data.email});
      blobDownload('Scope-demo.ics',ics);
      const gcal=googleCalendarUrl({start,end,title,details:desc});
      const gcalLink=$('#gcal'); gcalLink.href=gcal; gcalLink.style.display='inline-flex';

      $('#status').textContent=t('sending');

      try{
        const res=await fetch('/.netlify/functions/book-demo',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({...data,start:start.toISOString(),end:end.toISOString(),lang:l,ics})});
        $('#ok').style.display='block';
        $('#status').textContent=t('sent');
      }catch(err){
        $('#ok').style.display='block';
        $('#status').textContent=t('sent');
      } finally {
        submitBtn.disabled=false; submitBtn.textContent=t('submit');
        $('#ok').scrollIntoView({behavior:'smooth',block:'center'});
      }
    });
  </script>
</body>
</html>
